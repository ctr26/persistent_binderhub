binderhub:
  # Helm config for BinderHub goes here
  # see https://github.com/jupyterhub/binderhub/blob/master/helm-chart/binderhub/values.yaml
  pdb:
    minAvailable: 0
  # NOTE: binder pod must have 1 replica,
  # otherwise there are authentication errors
  # (https://github.com/jupyterhub/jupyterhub/issues/2841)
  replicas: 1

  config:
    BinderHub:
      auth_enabled: true
      # NOTE: when base_url is changed,
      # change also binder_base_url and static_binder in jupyterhub.hub.extraConfig.20-template-variables
      base_url: /services/binder/
      use_registry: true
      build_image: jupyter/repo2docker:2021.03.0-53.geb75209

  extraEnv:
    - name: PROJECTS_LIMIT_PER_USER
      value: "5"

  extraConfig:
    20-launcher:  |
      import json
      import os
      from tornado import web

      async def check_user_projects(launcher, image, username, server_name, repo_url):
          """Checks if current user exceeds the limit of projects stored per user or not.
          If yes, show an error message to user.
          """
          projects_limit = int(os.getenv('PROJECTS_LIMIT_PER_USER', 0))
          if projects_limit > 0:
            # we are making request to API with admin token
            resp = await launcher.api_request(
                'projects/%s' % username,
                method='GET',
            )
            body = json.loads(resp.body.decode('utf-8'))
            projects = body['projects']
            if projects:
              projects_repo_list = [p['repo_url'] for p in projects]
              if repo_url not in projects_repo_list and len(projects) >= projects_limit:
                  raise web.HTTPError(409, "No more than {} projects is allowed. "
                                           "One must be deleted before a new project can be created.".
                                           format(projects_limit))
      c.Launcher.pre_launch_hook = check_user_projects

  cors: &cors
    allowOrigin: '*'

  jupyterhub:
    # Helm config for JupyterHub goes here
    # see https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/master/jupyterhub/values.yaml
    custom:
      cors: *cors
      binderauth_enabled: true
      mount_all_projects: true
      default_project:
        repo_url: "https://github.com/gesiscss/persistent_binderhub"
        ref: "0.2.0-n645"
    cull:
      # don't cull authenticated users
      users: False
    hub:
      # NOTE: hub and proxy must have 1 pod
      # (https://github.com/jupyterhub/jupyterhub/issues/2841#issuecomment-561848594)
      # replicas: 1
      pdb:
        minAvailable: 0

      templatePaths:
        - "/etc/jupyterhub/templates"
      extraFiles:
        persistent_bhub_config:
          mountPath: /usr/local/etc/jupyterhub/persistent_bhub_config.py
          binaryData: IiIiCkN1c3RvbSBLdWJlU3Bhd25lciBhbmQgYW4gQVBJIGhhbmRsZXIgZm9yIHByb2plY3RzIHRvIGJlIHVzZWQgaW4gcGVyc2lzdGVudCBCaW5kZXJIdWIgZGVwbG95bWVudC4KVGhlc2UgYXJlIGltcG9ydGVkIGluIGJpbmRlcmh1Yi5qdXB5dGVyaHViLmh1Yi5leHRyYUNvbmZpZyBpbiB2YWx1ZXMueWFtbC4KIiIiCmltcG9ydCByZQppbXBvcnQganNvbgppbXBvcnQgc3RyaW5nCmltcG9ydCByYW5kb20KaW1wb3J0IHoyamgKZnJvbSBvcy5wYXRoIGltcG9ydCBqb2luCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZQpmcm9tIHRvcm5hZG8gaW1wb3J0IHdlYgpmcm9tIGp1cHl0ZXJodWIudXRpbHMgaW1wb3J0IGFkbWluX29ubHkKZnJvbSBqdXB5dGVyaHViLmFwaWhhbmRsZXJzLnVzZXJzIGltcG9ydCBhZG1pbl9vcl9zZWxmCmZyb20ganVweXRlcmh1Yi5hcGloYW5kbGVycy5iYXNlIGltcG9ydCBBUElIYW5kbGVyCmZyb20ga3ViZXNwYXduZXIgaW1wb3J0IEt1YmVTcGF3bmVyCmZyb20gdHJhaXRsZXRzIGltcG9ydCBMaXN0CgpERUZBVUxUX1BST1ZJREVSUyA9ICgKICAgIHsicHJlZml4IjogImdoIiwgIm5hbWUiOiAiR2l0SHViIiwgImhvc3RuYW1lIjogImdpdGh1Yi5jb20ifSwKICAgIHsicHJlZml4IjogImdpdCIsICJuYW1lIjogIkdpdCIsICJob3N0bmFtZSI6IE5vbmV9LAogICAgeyJwcmVmaXgiOiAiZ2wiLCAibmFtZSI6ICJHaXRMYWIiLCAiaG9zdG5hbWUiOiAiZ2l0bGFiLmNvbSJ9LAogICAgeyJwcmVmaXgiOiAiZ2lzdCIsICJuYW1lIjogIkdpc3QiLCAiaG9zdG5hbWUiOiAiZ2lzdC5naXRodWIuY29tIn0sCiAgICAjIGhvc3RuYW1lIGlzIHRoZSBzdHJpbmcgInplbm9kbyIgYXMgaW4gdGhlIGZvcm1hdCAxMC41MjgxL3plbm9kby40Mjc0NTA1CiAgICAjIFRPRE86IGFyYml0cmFyeSBET0lzPwogICAgeyJwcmVmaXgiOiAiemVub2RvIiwgIm5hbWUiOiAiWmVub2RvIERPSSIsICJob3N0bmFtZSI6ICJ6ZW5vZG8ifSwKICAgICMgaG9zdG5hbWUgaXMgdGhlIHN0cmluZyAiZmlnc2hhcmUiIGFzIGluIHRoZSBmb3JtYXQgMTAuNjA4NC9tOS5maWdzaGFyZS45NzgyNzc3LnYxCiAgICAjIFRPRE86IHNlbGYgaG9zdGVkIERPSXM/CiAgICB7InByZWZpeCI6ICJmaWdzaGFyZSIsICJuYW1lIjogIkZpZ3NoYXJlIERPSSIsICJob3N0bmFtZSI6ICJmaWdzaGFyZSJ9LAogICAgeyJwcmVmaXgiOiAiaHlkcm9zaGFyZSIsICJuYW1lIjogIkh5ZHJvc2hhcmUgcmVzb3VyY2UiLCAiaG9zdG5hbWUiOiAiaHlkcm9zaGFyZS5vcmcifSwKICAgICMgaG9zdG5hbWUgaXMgdGhlIHN0cmluZyAiZHZuIiAobG93ZXJjYXNlZCkgYXMgaW4gdGhlIGZvcm1hdCAxMC43OTEwL0RWTi9USkNMS1AKICAgICMgVE9ETzogc2VsZiBob3N0ZWQgRE9Jcz8KICAgIHsicHJlZml4IjogImRhdGF2ZXJzZSIsICJuYW1lIjogIkRhdGF2ZXJzZSBET0kiLCAiaG9zdG5hbWUiOiAiZHZuIn0sCikKCkRFRkFVTFRfUFJPVklERVIgPSB7InByb3ZpZGVyX3ByZWZpeCI6ICJnaXQiLCAicHJvdmlkZXJfbmFtZSI6ICJHaXQifQoKCmNsYXNzIFBlcnNpc3RlbnRCaW5kZXJTcGF3bmVyKEt1YmVTcGF3bmVyKToKICAgICIiIkFzc3VtaW5nIHRoYXQgZWFjaCB1c2VyIGhhcyBhIHN0b3JhZ2UgKFBlcnNpc3RlbnQgVm9sdW1lKQogICAgLSBjb3BpZXMgbGF1bmNoZWQgcHJvamVjdCdzIGRhdGEgKHJlcG8gY29udGVudCkgaW50byBhIHNlcGFyYXRlIGRpcmVjdG9yeSBieSB1c2luZyBgaW5pdENvbnRhaW5lcnNgLgogICAgICBTbyBpbiB0aGUgcHJvamVjdCBkaXIgd2UgaGF2ZSB0aGUgc2FtZSBjb250ZW50IGFzIHByb3ZpZGVkIGJ5IHJlcG8yZG9ja2VyLgogICAgICBUaGlzIGlzIHBhcnRpY3VsYXJseSBpbXBvcnRhbnQgYmVjYXVzZSBwcm9qZWN0cyBtYXkgdXNlIGZ1cnRoZXIgZmVhdHVyZXMgb2YgcmVwbzJkb2NrZXIgc3VjaCBhcyB0aGUgcG9zdEJ1aWxkIHNjcmlwdC4KICAgIC0gZGVsZXRlcyBkaXJzIG9mIHByb2plY3RzLCB3aGljaCBhcmUgaW4gc3RhdGVbImRlbGV0ZWRfcHJvamVjdHMiXSBvZiBgc3Bhd25lcnNgIHRhYmxlCiAgICAtIG1vdW50cyB1c2Vy4oCZcyBQViBzb21ld2hlcmUgb3RoZXIgdGhhbiB0aGUgaG9tZSBkaXIgKHRvIC9wcm9qZWN0cyksIHNvIHRoYXQgdXNlcnMgY2FuIGFjY2VzcyBmaWxlcyBhY3Jvc3MgbXVsdGlwbGUgcHJvamVjdHMKICAgIC0gbW91bnRzIHRoZSBkaXIgb2YgdGhlIGxhdW5jaGVkIHByb2plY3QgKGZyb20gdXNlcuKAmXMgUFYpIGludG8gdGhlIGhvbWUgZGlyICgvaG9tZS9qb3Z5YW4pCiAgICAtIHN0YXJ0cyBhIG5vdGVib29rIHNlcnZlciBvbiBgL2hvbWUvam92eWFuYCB3aGljaCBpcyB0aGUgZGVmYXVsdCBiZWhhdmlvciBvZiBCaW5kZXJIdWIuCiAgICAgIFRha2VzIHByb2plY3QgaW5mb3JtYXRpb24gKGUuZy4gaW1hZ2UgYW5kIHJlcG8gdXJsKSBmcm9tIGB1c2VyX29wdGlvbnNgLCB3aGljaCBpcyBzZXQgYnkgYmluZGVyLgogICAgLSBhZGRzL3VwZGF0ZXMgZGF0YSBvZiB0aGUgbGF1bmNoZWQgcHJvamVjdCBpbnRvIHN0YXRlWyJwcm9qZWN0cyJdIG9mIGBzcGF3bmVyc2AgdGFibGUKICAgICIiIgogICAgcmVwb19wcm92aWRlcnMgPSBMaXN0KAogICAgICAgIERFRkFVTFRfUFJPVklERVJTLAogICAgICAgIGNvbmZpZz1UcnVlLAogICAgICAgIGhlbHA9IiIiCiAgICAgICAgTGlzdCBvZiBSZXBvIFByb3ZpZGVycyB0byB1c2UgaW4gdGhlIFVJCiAgICAgICAgIiIiLAogICAgKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIF9yZXBvX3Byb3ZpZGVyX2J5X2RvbWFpbihzZWxmKToKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAoCiAgICAgICAgICAgICAgICByZXBvX3Byb3ZpZGVyWyJob3N0bmFtZSJdLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJwcm92aWRlcl9wcmVmaXgiOiByZXBvX3Byb3ZpZGVyWyJwcmVmaXgiXSwKICAgICAgICAgICAgICAgICAgICAicHJvdmlkZXJfbmFtZSI6IHJlcG9fcHJvdmlkZXJbIm5hbWUiXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIHJlcG9fcHJvdmlkZXIgaW4gc2VsZi5yZXBvX3Byb3ZpZGVycwogICAgICAgICAgICBpZiByZXBvX3Byb3ZpZGVyWyJob3N0bmFtZSJdIGlzIG5vdCBOb25lCiAgICAgICAgXQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgc3VwZXIoUGVyc2lzdGVudEJpbmRlclNwYXduZXIsIHNlbGYpLl9faW5pdF9fKCoqa3dhcmdzKQogICAgICAgICMgZ2V0IGRlZmF1bHRfcHJvamVjdCBmcm9tIGN1c3RvbSBjb25maWcgb2YgejJqaCBjaGFydCAoYGJpbmRlcmh1Yi5qdXB5dGVyaHViLmN1c3RvbWApCiAgICAgICAgIyBodHRwczovL3plcm8tdG8tanVweXRlcmh1Yi5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3QvYWRtaW5pc3RyYXRvci9hZHZhbmNlZC5odG1sI2N1c3RvbS1jb25maWd1cmF0aW9uCiAgICAgICAgZGVmYXVsdF9wcm9qZWN0ID0gejJqaC5nZXRfY29uZmlnKCdjdXN0b20uZGVmYXVsdF9wcm9qZWN0JykKICAgICAgICBkaXNwbGF5X25hbWUgPSBzZWxmLnVybF90b19kaXNwbGF5X25hbWUoZGVmYXVsdF9wcm9qZWN0WyJyZXBvX3VybCJdKQogICAgICAgICMgZGVmYXVsdF9wcm9qZWN0IGlzIG9ubHkgdG8gdXNlIHdoZW4gZmlyc3QgbG9naW4KICAgICAgICBzZWxmLmRlZmF1bHRfcHJvamVjdCA9IHsKICAgICAgICAgICAgInJlcG9fdXJsIjogZGVmYXVsdF9wcm9qZWN0WyJyZXBvX3VybCJdLAogICAgICAgICAgICAiaW1hZ2UiOiAiIiwKICAgICAgICAgICAgInJlZiI6IGRlZmF1bHRfcHJvamVjdFsicmVmIl0sCiAgICAgICAgICAgICJkaXNwbGF5X25hbWUiOiBkaXNwbGF5X25hbWUsCiAgICAgICAgICAgICJsYXN0X3VzZWQiOiAibmV2ZXIiLAogICAgICAgIH0KCiAgICBkZWYgdXJsX3RvX3Byb3ZpZGVyX2FyZ3Moc2VsZiwgdXJsOiBzdHIpIC0+IGRpY3Q6CiAgICAgICAgIiIiSW5mZXJzIHRoZSByZXBvIHByb3ZpZGVyIGZyb20gYSBVUkwuIiIiCiAgICAgICAgaWYgdXJsLmVuZHN3aXRoKCIuZ2l0Iik6CiAgICAgICAgICAgIHVybCA9IHVybFs6LTRdCiAgICAgICAgdXJsX3BhcnRzID0gdXJscGFyc2UodXJsKQogICAgICAgIHByb3ZpZGVyID0gdXJsX3BhcnRzLm5ldGxvYy5sb3dlcigpCiAgICAgICAgIyBGb3IgWmVub2RvLCBmaWdzaGFyZSwgZGF0YXZlcnNlIG9ubHkgRE9JIGlzIHN1cHBvcnRlZCBzbyBuZXRsb2Mgd2lsbCBiZSBhbiBlbXB0eSBzdHJpbmcuCiAgICAgICAgIyBpZiBvbmx5IGEgTUQ1IGhhc2ggaXMgcHJvdmlkZWQsIG5ldGxvYyB3aWxsIGJlIGFuIGVtcHR5IHN0cmluZyBhbmQgaXQncyBoeWRyb3NoYXJlIHJlc291cmNlIElELgogICAgICAgIGlmIGxlbihwcm92aWRlcikgPT0gMDoKICAgICAgICAgICAgcHJvdmlkZXIgPSB1cmxfcGFydHMucGF0aC5sb3dlcigpCiAgICAgICAgICAgICMgY2hlY2sgaWYgb25seSBoeWRyb3NoYXJlIHJlc291cmNlIElEIGlzIHByZXNlbnQKICAgICAgICAgICAgIyBJdCdzIGEgTUQ1IGhhc2gKICAgICAgICAgICAgaWYgbGVuKHJlLmZpbmRhbGwociIoW2EtZkEtRlxkXXszMn0pIiwgcHJvdmlkZXIpKSA9PSAxOgogICAgICAgICAgICAgICAgcHJvdmlkZXIgPSAnaHlkcm9zaGFyZScKCiAgICAgICAgZm9yIGRvbWFpbiwgYXJncyBpbiBzZWxmLl9yZXBvX3Byb3ZpZGVyX2J5X2RvbWFpbjoKICAgICAgICAgICAgaWYgZG9tYWluIGluIHByb3ZpZGVyOgogICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3MKICAgICAgICByZXR1cm4gREVGQVVMVF9QUk9WSURFUgoKICAgIGRlZiB1cmxfdG9fZGlzcGxheV9uYW1lKHNlbGYsIHVybCk6CiAgICAgICAgIiIiQ29udmVydHMgYSBVUkwgdG8gZGlzcGxheSBuYW1lIGluIGEgYHByZWZpeC91c2VyX29yX29yZ19uYW1lL3JlcG9fbmFtZWAgZm9ybWF0LiIiIgogICAgICAgIGlmIHVybC5lbmRzd2l0aCgnLmdpdCcpOgogICAgICAgICAgICB1cmwgPSB1cmxbOi00XQogICAgICAgIHVybF9wYXJ0cyA9IHVybHBhcnNlKHVybCkKICAgICAgICBwcm92aWRlcl9wcmVmaXggPSBzZWxmLnVybF90b19wcm92aWRlcl9hcmdzKHVybClbInByb3ZpZGVyX3ByZWZpeCJdCiAgICAgICAgcGF0aCA9IHVybF9wYXJ0cy5wYXRoLnN0cmlwKCcvJykKICAgICAgICBkaXNwbGF5X25hbWUgPSBmJ3twcm92aWRlcl9wcmVmaXh9L3twYXRofScKICAgICAgICByZXR1cm4gZGlzcGxheV9uYW1lCgogICAgZGVmIHVybF90b19kaXIoc2VsZiwgdXJsKToKICAgICAgICAiIiJDb252ZXJ0cyBhIFVSTCB0byBkaXJlY3RvcnkgbmFtZS4iIiIKICAgICAgICBkaXNwbGF5X25hbWUgPSBzZWxmLnVybF90b19kaXNwbGF5X25hbWUodXJsKQogICAgICAgIGRpcl9uYW1lID0gJycuam9pbihbYyBpZiBjLmlzYWxudW0oKSBvciBjIGluIFsnLScsICcuJ10gZWxzZSAnXycgZm9yIGMgaW4gZGlzcGxheV9uYW1lXSkKICAgICAgICBpZiBsZW4oZGlyX25hbWUpID4gMjU1OgogICAgICAgICAgICBzdWZmaXhfY2hhcnMgPSBzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cwogICAgICAgICAgICBzdWZmaXggPSByYW5kb20uY2hvaWNlcyhzdWZmaXhfY2hhcnMsIGs9OCkKICAgICAgICAgICAgZGlyX25hbWUgPSBmJ3tkaXJfbmFtZVs6MTIyXX1fe2Rpcl9uYW1lWy0xMjI6XX1fe3N1ZmZpeH0nCiAgICAgICAgcmV0dXJuIGRpcl9uYW1lCgogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgICIiIlN0YXJ0cyB0aGUgdXNlcidzIHBvZCB3aXRoIGB1c2VyX29wdGlvbnNgLCB3aGljaCBpcyBzZXQgYnkgYmluZGVyLgogICAgICAgIEJlZm9yZSBzdGFydGluZyB0aGUgbm90ZWJvb2sgc2VydmVyLCBzdGFydHMgYW4gYGluaXRDb250YWluZXJgIHdoaWNoCiAgICAgICAgZmlyc3QgZ2V0cyB0aGUgaW5mb3JtYXRpb24gb2YgcHJvamVjdHMgdG8gZGVsZXRlIGZyb20gc3RhdGVbImRlbGV0ZWRfcHJvamVjdHMiXSAoYHNwYXduZXJzYCB0YWJsZSksCiAgICAgICAgdGhlbiBkZWxldGVzIHRoZXNlIHByb2plY3RzIG9uIGRpc2sgKHVzZXIgc3RvcmFnZSksCiAgICAgICAgYW5kIHRoZW4gY29waWVzIGNvbnRlbnQgb2YgaW1hZ2UncyBob21lIGRpciBpbnRvIHByb2plY3QgZGlyIGlmIHByb2plY3QgZGlyIGRvZXNuJ3QgZXhpc3QuCgogICAgICAgIFN0YXJ0cyB0aGUgbm90ZWJvb2sgc2VydmVyIHdpdGggMiBtb3VudHMsCiAgICAgICAgZmlyc3Qgb25lIGlzIHRoZSB1c2VyIHN0b3JhZ2UgKHdoZXJlIGFsbCBwcm9qZWN0cyB0YWtlIHBsYWNlKSwgd2hpY2ggaXMgbW91bnRlZCB0byBgL3Byb2plY3RzYCBhbmQKICAgICAgICBzZWNvbmQgb25lIGlzIGN1cnJlbnRseSBsYXVuY2hlZCBwcm9qZWN0J3MgZGlyIG9uIHRoZSB1c2VyIHN0b3JhZ2UsIHdoaWNoIGlzIG1vdW50ZWQgdG8gYC9ob21lL2pvdnlhbmAuCgogICAgICAgIE5vdGU6IGluaXQgYW5kIG5vdGVib29rcyBjb250YWluZXJzIHNoYXJlcyBhIHZvbHVtZSAodXNlciBzdG9yYWdlKSwgdGhhdCdzIGhvdyBwcm9qZWN0IGNvbnRlbnQsIHdoaWNoIGlzCiAgICAgICAgY29waWVkIGJ5IGluaXQgY29udGFpbmVyLCBpcyBhbHNvIGF2YWlsYWJsZSB0byBub3RlYm9vayBjb250YWluZXIuCiAgICAgICAgIiIiCiAgICAgICAgIyBjbGVhbiBhdHRyaWJ1dGVzLCBzbyB3ZSBkb250IHNhdmUgd3JvbmcgdmFsdWVzIGluIHN0YXRlIHdoZW4gZXJyb3IgaGFwcGVucwogICAgICAgIGZvciBhdHRyIGluICgncmVwb191cmwnLCAncmVmJywgJ2ltYWdlJyk6CiAgICAgICAgICAgIHNlbGYuX19kaWN0X18ucG9wKGF0dHIsIE5vbmUpCgogICAgICAgICMgZ2V0IGltYWdlIHNwZWMgZnJvbSB1c2VyX29wdGlvbnMKICAgICAgICBpZiAnaW1hZ2UnIGluIHNlbGYudXNlcl9vcHRpb25zIGFuZCBcCiAgICAgICAgICAgJ3JlcG9fdXJsJyBpbiBzZWxmLnVzZXJfb3B0aW9ucyBhbmQgXAogICAgICAgICAgICd0b2tlbicgaW4gc2VsZi51c2VyX29wdGlvbnM6CiAgICAgICAgICAgICMgYmluZGVyIHNlcnZpY2Ugc2V0cyB0aGUgaW1hZ2Ugc3BlYyB2aWEgdXNlciBvcHRpb25zCiAgICAgICAgICAgICMgdXNlcl9vcHRpb25zIGlzIHNhdmVkIGluIGRhdGFiYXNlLCBzbyBldmVuIHVzZXIgZGVsZXRlcyBhbGwgcHJvamVjdHMsCiAgICAgICAgICAgICMgdXNlcl9vcHRpb25zIGZvciBsYXN0IGxhdW5jaGVkIHJlcG8gc3RheXMgaW4gZGF0YWJhc2UKICAgICAgICAgICAgIyBOT1RFOiB1c2VyIGNhbiBwYXNzIGFueSBvcHRpb25zIHRocm91Z2ggQVBJICh3aXRob3V0IHVzaW5nIGJpbmRlcikgdG9vCiAgICAgICAgICAgIHNlbGYuaW1hZ2UgPSBzZWxmLnVzZXJfb3B0aW9uc1snaW1hZ2UnXQogICAgICAgICAgICBzZWxmLnJlZiA9IHNlbGYuaW1hZ2Uuc3BsaXQoJzonKVstMV0KICAgICAgICAgICAgIyByZXBvX3VybCBpcyBnZW5lcmF0ZWQgaW4gYmluZGVyaHViIGJ5IHJlcG8gcHJvdmlkZXJzCiAgICAgICAgICAgIHNlbGYucmVwb191cmwgPSBzZWxmLnVzZXJfb3B0aW9uc1sncmVwb191cmwnXQogICAgICAgICAgICAjIHN0cmlwIC5naXQgYXQgdGhlIGVuZAogICAgICAgICAgICBpZiBzZWxmLnJlcG9fdXJsLmVuZHN3aXRoKCcuZ2l0Jyk6CiAgICAgICAgICAgICAgICBzZWxmLnJlcG9fdXJsID0gc2VsZi5yZXBvX3VybFs6LTRdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBpZiB1c2VyIG5ldmVyIGxhdW5jaGVkIGEgcmVwbyBiZWZvcmUgKHVzZXJfb3B0aW9ucyBpbiBkYXRhYmFzZSBpcyBlbXB0eSkKICAgICAgICAgICAgIyBhbmQgdXNlciBpcyB0cnlpbmcgdG8gc3RhcnQgdGhlIHNlcnZlciB2aWEgc3Bhd24gdXJsCiAgICAgICAgICAgICMgbm9ybWFsbHkgdGhpcyBzaG91bGRuJ3QgaGFwcGVuIGFuZAogICAgICAgICAgICAjIGl0IHdvdWxkIGJlIGdvb2QgYnV0IHdlIGNhbid0IGRpc3BsYXkgYSBtZXNzYWdlIHRvIHVzZXIsIGFuZCByYWlzaW5nIGVycm9ycyBjYXVzZSBodWIgdG8gcmVzdGFydAogICAgICAgICAgICAjIHNvIChhcyBhIHdvcmthcm91bmQpIGxhdW5jaCBhIHJlcG8gdW50aWwgd2UgaGFuZGxlIHRoaXMgYmV0dGVyIEZJWE1FCiAgICAgICAgICAgIHByb2plY3RzID0gc2VsZi5nZXRfc3RhdGVfZmllbGQoJ3Byb2plY3RzJykKICAgICAgICAgICAgaWYgcHJvamVjdHMgYW5kIHByb2plY3RzWy0xXS5nZXQoImltYWdlIik6CiAgICAgICAgICAgICAgICAjIGZpcnN0IGJlIHN1cmUgdGhhdCB1c2VyIGhhcyBubyB2YWxpZCBwcm9qZWN0cwogICAgICAgICAgICAgICAgc2VsZi5yZXBvX3VybCA9IHByb2plY3RzWy0xXVsicmVwb191cmwiXQogICAgICAgICAgICAgICAgc2VsZi5pbWFnZSA9IHByb2plY3RzWy0xXVsiaW1hZ2UiXQogICAgICAgICAgICAgICAgc2VsZi5yZWYgPSBwcm9qZWN0c1stMV1bInJlZiJdCiAgICAgICAgICAgICAgICBzZWxmLmxvZy53YXJuaW5nKGYiUHJvamVjdCAne3NlbGYucmVwb191cmx9JyB3aXRoICd7c2VsZi5pbWFnZX0nIGRvZXNuJ3QgZXhpc3QgaW4gdXNlcl9vcHRpb25zLiIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBtc2cgPSBmIlVzZXIgKHtzZWxmLnVzZXIubmFtZX0pIGlzIHRyeWluZyB0byBzdGFydCB0aGUgc2VydmVyIHZpYSBzcGF3biB1cmwuIgogICAgICAgICAgICAgICAgIyBzZWxmLmhhbmRsZXIucmVkaXJlY3QoIi9odWIvaG9tZSIpCiAgICAgICAgICAgICAgICAjIHJhaXNlIEV4Y2VwdGlvbihtc2cpCiAgICAgICAgICAgICAgICBzZWxmLmxvZy5pbmZvKG1zZykKICAgICAgICAgICAgICAgIHNlbGYucmVwb191cmwgPSAiaHR0cHM6Ly9naXRodWIuY29tL2dlc2lzY3NzL3BlcnNpc3RlbnRfYmluZGVyaHViIgogICAgICAgICAgICAgICAgc2VsZi5pbWFnZSA9ICJnZXNpc2Nzcy9iaW5kZXItZ2VzaXNjc3MtMmRwZXJzaXN0ZW50LTVmYmluZGVyaHViLWFiMTA3ZjowLjIuMC1uNjQ1IgogICAgICAgICAgICAgICAgc2VsZi5yZWYgPSBzZWxmLmltYWdlLnNwbGl0KCc6JylbLTFdCiAgICAgICAgc2VsZi5sb2cuaW5mbyhmIlVzZXIgKHtzZWxmLnVzZXIubmFtZX0pIGlzIGxhdW5jaGluZyAne3NlbGYucmVwb191cmx9JyBwcm9qZWN0IHdpdGggJ3tzZWxmLmltYWdlfScuIikKCiAgICAgICAgIyBwcmVwYXJlIHRoZSBpbml0Q29udGFpbmVyCiAgICAgICAgIyBOT1RFOiBmaXJzdCBpbml0Q29udGFpbmVyIHJ1bnMgYW5kIHdoZW4gaXQgaXMgZG9uZSwgdGhlbiBub3RlYm9vayBjb250YWluZXIgcnVucwogICAgICAgICMgaHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvY29uY2VwdHMvd29ya2xvYWRzL3BvZHMvaW5pdC1jb250YWluZXJzLwogICAgICAgICMgaHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvdGFza3MvY29uZmlndXJlLXBvZC1jb250YWluZXIvY29uZmlndXJlLXBvZC1pbml0aWFsaXphdGlvbi8jY3JlYXRlLWEtcG9kLXRoYXQtaGFzLWFuLWluaXQtY29udGFpbmVyCiAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vanVweXRlcmh1Yi9rdWJlc3Bhd25lci9ibG9iL3YwLjguMS9rdWJlc3Bhd25lci9zcGF3bmVyLnB5I0w2MzgtTDY2NAogICAgICAgIG1vdW50X3BhdGggPSAnL3Byb2plY3RzLycKICAgICAgICAjIGZpcnN0IGl0IGRlbGV0ZXMgcHJvamVjdHMgb24gZGlzayAoaWYgdGhlcmUgYXJlIGFueSB0byBkZWxldGUpCiAgICAgICAgIyBnZXQgbGlzdCBvZiBwcm9qZWN0cyB0byBkZWxldGUgZnJvbSBkaXNrIGJlZm9yZSBzcGF3biBpbiBpbml0Q29udGFpbmVyCiAgICAgICAgZGVsZXRlZF9wcm9qZWN0cyA9IHNlbGYuZ2V0X3N0YXRlX2ZpZWxkKCdkZWxldGVkX3Byb2plY3RzJykKICAgICAgICBpZiBkZWxldGVkX3Byb2plY3RzOgogICAgICAgICAgICBkZWxldGVfY21kID0gZiJybSAtcmYgeycgJy5qb2luKFtqb2luKG1vdW50X3BhdGgsIHNlbGYudXJsX3RvX2RpcihkKSkgZm9yIGQgaW4gZGVsZXRlZF9wcm9qZWN0c10pfSIKICAgICAgICAgICAgc2VsZi5sb2cuaW5mbyhmIkZvbGxvd2luZyBwcm9qZWN0cyB3aWxsIGJlIGRlbGV0ZWQgZm9yIHVzZXIgKHtzZWxmLnVzZXIubmFtZX0pOiB7ZGVsZXRlZF9wcm9qZWN0c30iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlbGV0ZV9jbWQgPSAiIgogICAgICAgICMgdGhlbiBjb3BpZXMgaW1hZ2UncyBob21lIGRpciAocmVwbyBjb250ZW50IGFmdGVyIHIyZCBwcm9jZXNzKQogICAgICAgICMgaW50byBwcm9qZWN0J3MgZGlyIG9uIGRpc2sgKGlmIHByb2plY3RfcGF0aCBkb2VzbnQgZXhpc3RzIG9uIHBlcnNpc3RlbnQgZGlzaykKICAgICAgICBwcm9qZWN0X2RpciA9IHNlbGYudXJsX3RvX2RpcihzZWxmLnJlcG9fdXJsKQogICAgICAgIHByb2plY3RfcGF0aCA9IGpvaW4obW91bnRfcGF0aCwgcHJvamVjdF9kaXIpCiAgICAgICAgY29weV9jbWQgPSBmImlmIFsgLWQge3Byb2plY3RfcGF0aH0gXTsgIiBcCiAgICAgICAgICAgICAgICAgICBmInRoZW4gZWNobyAnZGlyZWN0b3J5IHtwcm9qZWN0X3BhdGh9IGV4aXN0cyc7ICIgXAogICAgICAgICAgICAgICAgICAgZiJlbGlmIFsgLUwge3Byb2plY3RfcGF0aH0gXTsgIiBcCiAgICAgICAgICAgICAgICAgICBmInRoZW4gZWNobyAne3Byb2plY3RfcGF0aH0gaXMgYSBzeW1saW5rJzsgIiBcCiAgICAgICAgICAgICAgICAgICBmImVsc2UgbWtkaXIge3Byb2plY3RfcGF0aH0gJiYgY3AgLWEgfi8uIHtwcm9qZWN0X3BhdGh9OyBmaSIKICAgICAgICBpbml0X2NvbnRhaW5lcl9jbWRzID0gW2RlbGV0ZV9jbWQsIGNvcHlfY21kXSBpZiBkZWxldGVfY21kIGVsc2UgW2NvcHlfY21kXQogICAgICAgIGNvbW1hbmQgPSBbIi9iaW4vc2giLCAiLWMiLCAiICYmICIuam9pbihpbml0X2NvbnRhaW5lcl9jbWRzKV0KICAgICAgICBzZWxmLmxvZy5kZWJ1ZyhmIkZvbGxvd2luZyBjb21tYW5kIHdpbGwgYmUgZXhlY3V0ZWQgZm9yIHVzZXIgKHtzZWxmLnVzZXIubmFtZX0pOiB7Y29tbWFuZH0iKQogICAgICAgIHByb2plY3RzX3ZvbHVtZV9tb3VudCA9IHsnbmFtZSc6IHNlbGYudm9sdW1lc1swXVsnbmFtZSddLCAnbW91bnRQYXRoJzogbW91bnRfcGF0aH0KICAgICAgICAjIE5PVEU6IGlmIGJpbmRlciAic3RhcnQiIGNvbmZpZyBpcyBkZWZpbmVkCiAgICAgICAgIyAgKGh0dHBzOi8vbXliaW5kZXIucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2NvbmZpZ19maWxlcy5odG1sI3N0YXJ0LXJ1bi1jb2RlLWJlZm9yZS10aGUtdXNlci1zZXNzaW9ucy1zdGFydHMpCiAgICAgICAgIyAgYW5kIGlmIHN0YXJ0IGNvbW1hbmQgY2hhbmdlcyB0aGUgY29udGVudCwKICAgICAgICAjICBpbml0Y29udGFpbmVyIG1pc3NlcyB0aGF0IGNoYW5nZS4KICAgICAgICAjICBiZWNhdXNlIHN0YXJ0IGNvbW1hbmQgaXMgcnVuIGFzIGFuIEVOVFJZUE9JTlQgYW5kIGluaXRjb250YWluZXIncyBjb21tYW5kIG92ZXJ3cml0ZXMgaXQKICAgICAgICAjICBCdXQgc3RhcnQgY29tbWFuZCB3aWxsIGJlIGV4ZWN1dGVkIGluIG5vdGVib29rIGNvbnRhaW5lciAoYmVjYXVzZSB3ZSBkb250IGRlZmluZSBhIGN1c3RvbSBjb21tYW5kIGZvciBpdCksCiAgICAgICAgIyAgc28gY2hhbmdlIHdpbGwgdGFrZSBwbGFjZSB0aGVyZSwgYW5kIG9uIHVzZXIncyBzaWRlLCB0aGVyZSBpcyBubyBwcm9ibGVtCiAgICAgICAgc2VsZi5pbml0X2NvbnRhaW5lcnMuYXBwZW5kKHsKICAgICAgICAgICAgIm5hbWUiOiAicHJvamVjdC1tYW5hZ2VyIiwKICAgICAgICAgICAgImltYWdlIjogc2VsZi5pbWFnZSwKICAgICAgICAgICAgImNvbW1hbmQiOiBjb21tYW5kLAogICAgICAgICAgICAjIHZvbHVtZXMgaXMgYWxyZWFkeSBkZWZpbmVkIGZvciBub3RlYm9vayBjb250YWluZXIgKHNlbGYudm9sdW1lcykKICAgICAgICAgICAgInZvbHVtZV9tb3VudHMiOiBbcHJvamVjdHNfdm9sdW1lX21vdW50XSwKICAgICAgICB9KQoKICAgICAgICAjIG5vdGVib29rIGNvbnRhaW5lciAodXNlciBzZXJ2ZXIpCiAgICAgICAgIyBtb3VudCBhbGwgcHJvamVjdHMgKGNvbXBsZXRlIHVzZXIgZGlzaykgdG8gL3Byb2plY3RzCiAgICAgICAgIyBmaXJzdCByZW1vdmUgZXhpc3Rpbmcgdm9sdW1lIG1vdW50cyB0byAvcHJvamVjdHMsIHRoaXMgbW91bnQgcGF0aCBzaG91bGQgYmUgdW5pcXVlLAogICAgICAgICMgbm9ybWFsbHkgd2Ugc2hvdWxkbid0IG5lZWQgdGhpcywgYnV0IHNvbWV0aW1lcyB0aGVyZSBpcyBkdXBsaWNhdGlvbiB3aGVuIHRoZXJlIGlzIGEgc3Bhd24gZXJyb3IKICAgICAgICAjIGZvciBleGFtcGxlIHRpbWVvdXQgZXJyb3IgZHVlIHRvIGxvbmcgZG9ja2VyIHB1bGwgKG9mIGEgbm90ZWJvb2sgc2VydmVyIGltYWdlKQogICAgICAgIGZvciBpLCB2X20gaW4gZW51bWVyYXRlKHNlbGYudm9sdW1lX21vdW50cyk6CiAgICAgICAgICAgIGlmIHZfbVsnbW91bnRQYXRoJ10gPT0gcHJvamVjdHNfdm9sdW1lX21vdW50Wydtb3VudFBhdGgnXToKICAgICAgICAgICAgICAgIGRlbCBzZWxmLnZvbHVtZV9tb3VudHNbaV0KCiAgICAgICAgIyBvbmx5IG1vdW50IC9wcm9qZWN0cyBpbiB0aGUgdXNlciBzZXJ2ZXIgaWYgbW91bnRpbmcgYWxsIHByb2plY3RzIGlzIGVuYWJsZWQKICAgICAgICBpZiB6MmpoLmdldF9jb25maWcoJ2N1c3RvbS5tb3VudF9hbGxfcHJvamVjdHMnKToKICAgICAgICAgICAgc2VsZi52b2x1bWVfbW91bnRzLmFwcGVuZChwcm9qZWN0c192b2x1bWVfbW91bnQpCgogICAgICAgICMgbW91bnRQYXRoIGlzIC9ob21lL2pvdnlhbiwgdGhpcyBpcyBzZXQgaW4gejJqaCBoZWxtIGNoYXJ0IHZhbHVlcy55YW1sCiAgICAgICAgIyBtb3VudF9wYXRoID0gIn4vIgogICAgICAgICMgbW91bnRfcGF0aCA9ICIkKEhPTUUpIgogICAgICAgICMgc2VsZi52b2x1bWVfbW91bnRzWzBdWydtb3VudFBhdGgnXSA9IG1vdW50X3BhdGgKICAgICAgICAjIGh0dHBzOi8va3ViZXJuZXRlcy5pby9kb2NzL2NvbmNlcHRzL3N0b3JhZ2Uvdm9sdW1lcy8jdXNpbmctc3VicGF0aAogICAgICAgICMgbW91bnQgb25seSBwcm9qZWN0X3BhdGggdG8gaG9tZQogICAgICAgIHNlbGYudm9sdW1lX21vdW50c1swXVsnc3ViUGF0aCddID0gcHJvamVjdF9kaXIKCiAgICAgICAgc2VsZi5yZXNldF9kZWxldGVkX3Byb2plY3RzID0gVHJ1ZQogICAgICAgIHJldHVybiBzdXBlcigpLnN0YXJ0KCkKCiAgICBkZWYgZ2V0X3N0YXRlX2ZpZWxkKHNlbGYsIGZpZWxkX25hbWUpOgogICAgICAgICIiIlJldHVybnMganVzdCBjdXJyZW50IHZhbHVlIG9mIGEgZmllbGQgaW4gc3RhdGUsIGRvZXNuJ3QgdXBkYXRlIGFueXRoaW5nIGluIHNwYXduZXIncyBzdGF0ZS4iIiIKICAgICAgICBzZWxmLnVwZGF0ZV9wcm9qZWN0cyA9IEZhbHNlCiAgICAgICAgcmVzZXRfZGVsZXRlZF9wcm9qZWN0cyA9IGdldGF0dHIoc2VsZiwgJ3Jlc2V0X2RlbGV0ZWRfcHJvamVjdHMnLCBGYWxzZSkKICAgICAgICBzZWxmLnJlc2V0X2RlbGV0ZWRfcHJvamVjdHMgPSBGYWxzZQogICAgICAgIHN0YXRlID0gc2VsZi5nZXRfc3RhdGUoKQogICAgICAgIHNlbGYudXBkYXRlX3Byb2plY3RzID0gVHJ1ZQogICAgICAgIHNlbGYucmVzZXRfZGVsZXRlZF9wcm9qZWN0cyA9IHJlc2V0X2RlbGV0ZWRfcHJvamVjdHMKICAgICAgICByZXR1cm4gc3RhdGVbZmllbGRfbmFtZV0KCiAgICBkZWYgZ2V0X3N0YXRlKHNlbGYpOgogICAgICAgICIiIlVwZGF0ZXMgc3RhdGVbInByb2plY3RzIl0gaW4gYHNwYXduZXJzYCB0YWJsZSBhbmQgcmV0dXJucyB0aGUgdXBkYXRlZCBzdGF0ZSB2YWx1ZS4KCiAgICAgICAgV2UgdXNlIHRoaXMgbWV0aG9kIHRvIHVwZGF0ZSBwcm9qZWN0cywgYmVjYXVzZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYm90aCBpbgogICAgICAgIHN0YXJ0IGFuZCBzdG9wIG9mIHRoZSBzZXJ2ZXIgKHNlZSBqdXB5dGVyaHViLlVzZXIncyBgc3RhcnRgIGFuZCBgc3RvcGAgbWV0aG9kcyksCiAgICAgICAgZGIuY29tbWl0IGlzIGNhbGxlZCBhZnRlciB0aGVzZSBtZXRob2RzLgogICAgICAgICIiIgogICAgICAgIF9zdGF0ZSA9IHNlbGYub3JtX3NwYXduZXIuc3RhdGUKICAgICAgICBpZiBfc3RhdGU6CiAgICAgICAgICAgICMgdXNlciBhbHJlYWR5IGxhdW5jaGVkIGEgcHJvamVjdCAoc3RhcnRlZCBpdHMgc2VydmVyKSwgc3Bhd25lciBoYXMgYSBzdGF0ZQogICAgICAgICAgICBwcm9qZWN0cyA9IF9zdGF0ZS5nZXQoJ3Byb2plY3RzJywgW10pCiAgICAgICAgICAgIF9wcm9qZWN0cyA9IFtdCiAgICAgICAgICAgIGZvciBwcm9qZWN0IGluIHByb2plY3RzOgogICAgICAgICAgICAgICAgIyB0byBiZSBiYWNrd2FyZHMgY29tcGF0aWJsZSBmb3IgdmVyc2lvbiA8PSAwLjIuMC1uMTUzCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgbGlzdCwgd2hpY2ggY29udGFpbnMgcHJvamVjdCBkYXRhLCB0byBkaWN0CiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHByb2plY3QsIGxpc3QpOgogICAgICAgICAgICAgICAgICAgIF9wcm9qZWN0cy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAicmVwb191cmwiOiBwcm9qZWN0WzBdLAogICAgICAgICAgICAgICAgICAgICAgICAiaW1hZ2UiOiBwcm9qZWN0WzFdLAogICAgICAgICAgICAgICAgICAgICAgICAicmVmIjogcHJvamVjdFsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgImRpc3BsYXlfbmFtZSI6IHByb2plY3RbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X3VzZWQiOiBwcm9qZWN0WzRdLAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIF9wcm9qZWN0cy5hcHBlbmQocHJvamVjdCkKICAgICAgICAgICAgcHJvamVjdHMgPSBfcHJvamVjdHMKICAgICAgICAgICAgZGVsZXRlZF9wcm9qZWN0cyA9IF9zdGF0ZS5nZXQoJ2RlbGV0ZWRfcHJvamVjdHMnLCBbXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIGlmIHVzZXIgbmV2ZXIgbGF1bmNoZWQgcHJvamVjdCAoc3RhdGUgaXMgZW1wdHkpLCB1c2UgZGVmYXVsdF9wcm9qZWN0CiAgICAgICAgICAgIHByb2plY3RzID0gW3NlbGYuZGVmYXVsdF9wcm9qZWN0XQogICAgICAgICAgICBkZWxldGVkX3Byb2plY3RzID0gW10KICAgICAgICAgICAgc2VsZi5sb2cuaW5mbyhmIlVzZXIgKHtzZWxmLnVzZXIubmFtZX0pIGhhc24ndCBsYXVuY2hlZCBhIHByb2plY3QgeWV0LiIpCiAgICAgICAgc3RhdGUgPSBzdXBlcigpLmdldF9zdGF0ZSgpCiAgICAgICAgcHJvamVjdHMgPSBbCiAgICAgICAgICAgIHsqKnByb2plY3QsICoqc2VsZi51cmxfdG9fcHJvdmlkZXJfYXJncyhwcm9qZWN0WyJyZXBvX3VybCJdKX0KICAgICAgICAgICAgZm9yIHByb2plY3QgaW4gcHJvamVjdHMKICAgICAgICBdCiAgICAgICAgc3RhdGVbJ3Byb2plY3RzJ10gPSBwcm9qZWN0cwogICAgICAgIHN0YXRlWydkZWxldGVkX3Byb2plY3RzJ10gPSBkZWxldGVkX3Byb2plY3RzCgogICAgICAgIGlmIGdldGF0dHIoc2VsZiwgJ3VwZGF0ZV9wcm9qZWN0cycsIFRydWUpIGlzIFRydWUgYW5kIFwKICAgICAgICAgICBoYXNhdHRyKHNlbGYsICdyZXBvX3VybCcpIGFuZCBoYXNhdHRyKHNlbGYsICdpbWFnZScpIGFuZCBoYXNhdHRyKHNlbGYsICdyZWYnKToKICAgICAgICAgICAgIyBwcm9qZWN0IGlzIHN0YXJ0ZWQgb3IgYWxyZWFkeSBydW5uaW5nIG9yIGlzIHN0b3BwZWQsCiAgICAgICAgICAgICMgc28gbW92ZSBwcm9qZWN0IHRvIHRoZSBlbmQgYW5kIHVwZGF0ZSB0aGUgImxhc3QgdXNlZCIgdGltZQogICAgICAgICAgICBuZXdfcHJvamVjdHMgPSBbXQogICAgICAgICAgICBmb3IgcHJvamVjdCBpbiBwcm9qZWN0czoKICAgICAgICAgICAgICAgIGlmIHByb2plY3RbInJlcG9fdXJsIl0gIT0gc2VsZi5yZXBvX3VybDoKICAgICAgICAgICAgICAgICAgICBuZXdfcHJvamVjdHMuYXBwZW5kKHByb2plY3QpCiAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCiAgICAgICAgICAgIG5ld19wcm9qZWN0cy5hcHBlbmQoewogICAgICAgICAgICAgICAgInJlcG9fdXJsIjogc2VsZi5yZXBvX3VybCwKICAgICAgICAgICAgICAgICJpbWFnZSI6IHNlbGYuaW1hZ2UsCiAgICAgICAgICAgICAgICAicmVmIjogc2VsZi5yZWYsCiAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogc2VsZi51cmxfdG9fZGlzcGxheV9uYW1lKHNlbGYucmVwb191cmwpLAogICAgICAgICAgICAgICAgImxhc3RfdXNlZCI6IGRhdGV0aW1lLnV0Y25vdygpLmlzb2Zvcm1hdCgpICsgJ1onLAogICAgICAgICAgICAgICAgKipzZWxmLnVybF90b19wcm92aWRlcl9hcmdzKHNlbGYucmVwb191cmwpLAogICAgICAgICAgICB9KQogICAgICAgICAgICBzdGF0ZVsncHJvamVjdHMnXSA9IG5ld19wcm9qZWN0cwogICAgICAgICAgICBzZWxmLmxvZy5pbmZvKGYiVXNlciAoe3NlbGYudXNlci5uYW1lfSkgaGFzIGp1c3QgdXNlZCB0aGUgcHJvamVjdCB7c2VsZi5yZXBvX3VybH0uIikKCiAgICAgICAgaWYgZ2V0YXR0cihzZWxmLCAncmVzZXRfZGVsZXRlZF9wcm9qZWN0cycsIEZhbHNlKSBpcyBUcnVlOgogICAgICAgICAgICBzdGF0ZVsnZGVsZXRlZF9wcm9qZWN0cyddID0gW10KCiAgICAgICAgcmV0dXJuIHN0YXRlCgogICAgZGVmIGdldF9lbnYoc2VsZik6CiAgICAgICAgZW52ID0gc3VwZXIoKS5nZXRfZW52KCkKICAgICAgICBpZiAncmVwb191cmwnIGluIHNlbGYudXNlcl9vcHRpb25zOgogICAgICAgICAgICBlbnZbJ0JJTkRFUl9SRVBPX1VSTCddID0gc2VsZi51c2VyX29wdGlvbnNbJ3JlcG9fdXJsJ10KICAgICAgICBmb3Iga2V5IGluICgKICAgICAgICAgICAgICAgICdiaW5kZXJfcmVmX3VybCcsCiAgICAgICAgICAgICAgICAnYmluZGVyX2xhdW5jaF9ob3N0JywKICAgICAgICAgICAgICAgICdiaW5kZXJfcGVyc2lzdGVudF9yZXF1ZXN0JywKICAgICAgICAgICAgICAgICdiaW5kZXJfcmVxdWVzdCcpOgogICAgICAgICAgICBpZiBrZXkgaW4gc2VsZi51c2VyX29wdGlvbnM6CiAgICAgICAgICAgICAgICBlbnZba2V5LnVwcGVyKCldID0gc2VsZi51c2VyX29wdGlvbnNba2V5XQogICAgICAgIHJldHVybiBlbnYKCgpjbGFzcyBQcm9qZWN0QVBJSGFuZGxlcihBUElIYW5kbGVyKToKICAgICIiIkEgSnVweXRlckh1YiBBUEkgaGFuZGxlciB0byBtYW5hZ2UgdXNlciBwcm9qZWN0cy4iIiIKCiAgICBkZWYgZ2V0X2pzb25fYm9keShzZWxmKToKICAgICAgICBib2R5ID0gc3VwZXIoKS5nZXRfanNvbl9ib2R5KCkKICAgICAgICBpZiBib2R5IGlzIE5vbmU6CiAgICAgICAgICAgIGJvZHkgPSB7fQogICAgICAgIHJldHVybiBib2R5CgogICAgQGFkbWluX29ubHkKICAgIGFzeW5jIGRlZiBnZXQoc2VsZiwgdXNlcl9uYW1lKToKICAgICAgICAiIiJUYWtlcyBhIHVzZXIgbmFtZSBhbmQgcmV0dXJucyBwcm9qZWN0cyBvZiB0aGF0IHVzZXIuIiIiCiAgICAgICAgIyBnZXQgdXNlcidzIHByb2plY3RzCiAgICAgICAgdXNlciA9IHNlbGYuZmluZF91c2VyKHVzZXJfbmFtZSkKICAgICAgICBpZiBub3QgdXNlcjoKICAgICAgICAgICAgcmFpc2Ugd2ViLkhUVFBFcnJvcig0MDQpCiAgICAgICAgcHJvamVjdHMgPSB7J3Byb2plY3RzJzogdXNlci5zcGF3bmVyLmdldF9zdGF0ZV9maWVsZCgncHJvamVjdHMnKX0KICAgICAgICBzZWxmLndyaXRlKGpzb24uZHVtcHMocHJvamVjdHMpKQoKICAgIEBhZG1pbl9vcl9zZWxmCiAgICBhc3luYyBkZWYgZGVsZXRlKHNlbGYsIHVzZXJfbmFtZSk6CiAgICAgICAgIiIiRGVsZXRlcyBhIHByb2plY3QgZnJvbSBzdGF0ZVsicHJvamVjdHMiXSBhbmQgYWRkcyBpdCBpbnRvIHN0YXRlWyJkZWxldGVkX3Byb2plY3RzIl0KICAgICAgICBpbiBgc3Bhd25lcnNgIHRhYmxlIGluIGRhdGFiYXNlLiBJdCBkb2Vzbid0IGRlbGV0ZSBwcm9qZWN0IGZpbGVzIG9uIGRpc2sgKHVzZXIgc3RvcmFnZSksCiAgICAgICAgdGhpcyBpcyBkb25lIGJ5IGBJbml0Q29udGFpbmVyYCBkdXJpbmcgbGF1bmNoIG9mIGEgcHJvamVjdCBuZXh0IHRpbWUuCiAgICAgICAgSWYgdXNlciBoYXMgYSBydW5uaW5nIHNlcnZlciwgdGhpcyBtZXRob2QgcmV0dXJucyBhIG1lc3NhZ2UgdG8gdXNlciBhbmQgZG9lc24ndCBkbyBhbnkgY2hhbmdlLgogICAgICAgICIiIgogICAgICAgICMgZGVsZXRlIGEgcHJvamVjdCBvZiB1c2VyCiAgICAgICAgdXNlciA9IHNlbGYuZmluZF91c2VyKHVzZXJfbmFtZSkKICAgICAgICByZXNwb25zZSA9IHt9CiAgICAgICAgaWYgdXNlci5zcGF3bmVyLmFjdGl2ZToKICAgICAgICAgICAgcmVzcG9uc2VbImVycm9yIl0gPSAiUHJvamVjdCBkZWxldGlvbiBpcyBub3QgYWxsb3dlZCB3aGlsZSB0aGUgdXNlciBzZXJ2ZXIgaXMgYWN0aXZlLiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBib2R5ID0gc2VsZi5nZXRfanNvbl9ib2R5KCkKICAgICAgICAgICAgaWYgInJlcG9fdXJsIiBpbiBib2R5IGFuZCAibmFtZSIgaW4gYm9keSBhbmQgImlkIiBpbiBib2R5OgogICAgICAgICAgICAgICAgcmVwb191cmwgPSBib2R5WyJyZXBvX3VybCJdCiAgICAgICAgICAgICAgICBwcm9qZWN0cyA9IHVzZXIuc3Bhd25lci5nZXRfc3RhdGVfZmllbGQoJ3Byb2plY3RzJykKICAgICAgICAgICAgICAgIG5ld19wcm9qZWN0cyA9IFtdCiAgICAgICAgICAgICAgICBkZWxldGVkX3Byb2plY3RzID0gdXNlci5zcGF3bmVyLmdldF9zdGF0ZV9maWVsZCgnZGVsZXRlZF9wcm9qZWN0cycpCiAgICAgICAgICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBmb3IgcHJvamVjdCBpbiBwcm9qZWN0czoKICAgICAgICAgICAgICAgICAgICBpZiByZXBvX3VybCAhPSBwcm9qZWN0WyJyZXBvX3VybCJdOgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJvamVjdHMuYXBwZW5kKHByb2plY3QpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlcG9fdXJsIG5vdCBpbiBkZWxldGVkX3Byb2plY3RzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZF9wcm9qZWN0cy5hcHBlbmQocmVwb191cmwpCiAgICAgICAgICAgICAgICBpZiBmb3VuZCBpcyBUcnVlOgogICAgICAgICAgICAgICAgICAgICMgTk9URTogdGhpcyB3YXkgd2UgZW5zdXJlIHRoYXQgdGhpcyBKU09ORGljdCBmaWVsZCAoc3RhdGUpIGlzIHVwZGF0ZWQgd2l0aCBkYi5jb21taXQoKQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gdXNlci5zcGF3bmVyLmdldF9zdGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgc3RhdGVbInByb2plY3RzIl0gPSBuZXdfcHJvamVjdHMKICAgICAgICAgICAgICAgICAgICBzdGF0ZVsiZGVsZXRlZF9wcm9qZWN0cyJdID0gZGVsZXRlZF9wcm9qZWN0cwogICAgICAgICAgICAgICAgICAgIHVzZXIuc3Bhd25lci5vcm1fc3Bhd25lci5zdGF0ZSA9IHN0YXRlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYi5jb21taXQoKQogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlByb2plY3Qge2JvZHlbJ25hbWUnXX0gaXMgZGVsZXRlZC4iCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cuaW5mbyhmInt1c2VyLm5hbWV9OiB7bWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlWyJzdWNjZXNzIl0gPSBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VbImlkIl0gPSBib2R5WyJpZCJdCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlByb2plY3Qge2JvZHlbJ25hbWUnXX0gKHtib2R5WydyZXBvX3VybCddfSkgZG9lc24ndCBleGlzdC4iCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2cuaW5mbyhmInt1c2VyLm5hbWV9OiB7bWVzc2FnZX0iKQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlWyJlcnJvciJdID0gbWVzc2FnZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzcG9uc2VbImVycm9yIl0gPSAiQmFkIHJlcXVlc3QuIgogICAgICAgIHNlbGYud3JpdGUoanNvbi5kdW1wcyhyZXNwb25zZSkpCg==
        persistent_bhub_css:
          mountPath: /usr/local/share/jupyterhub/static/persistent_bhub/persistent_bhub.css
          binaryData: Lyogc3R5bGVzIGZvciBob21lLmh0bWwgKi8KI21haW4tY29udGFpbmVyIHsKCS8qb3ZlcmZsb3c6IGhpZGRlbjsqLwoJYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKCXBhZGRpbmctbGVmdDogMzJweDsKCXBhZGRpbmctcmlnaHQ6IDMycHg7Cn0KCiNoZWFkZXIgewoJbWFyZ2luLWxlZnQ6IDMlOwoJbWFyZ2luLWJvdHRvbTogMzJweDsKCW1hcmdpbi10b3A6IDMycHg7Cgl3aWR0aDogOTQlOwoJYm9yZGVyLWJvdHRvbTogMDsKCXBhZGRpbmctdG9wOiAxMnB4OwoJcGFkZGluZy1ib3R0b206IDI0cHg7Cn0KI2hlYWRlciA+IGgzIHsKICAgIC8qZm9udC1zaXplOiA0MnB4OyovCiAgICAvKmxpbmUtaGVpZ2h0OiAxLjM7Ki8KICAgIGRpc3BsYXk6IG5vbmU7Cn0KI2V4cGxhbmF0aW9uIHsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgICBsaW5lLWhlaWdodDogMS40OwoJY29sb3I6IHJnYig0MCwgNDAsIDQwKTsKCWZvbnQtc2l6ZTogMS44ZW07Cn0KCiNidWlsZC1mb3JtIHsKCW1hcmdpbi1ib3R0b206IDA7Cn0KLmJ1aWxkLWZvcm0gewoJcGFkZGluZzogNXB4IDE4cHggMjBweCAxOHB4ICFpbXBvcnRhbnQ7Cn0KI2J1aWxkLWZvcm0gLmNhcmV0IHsKICAgIGJvcmRlci10b3AtY29sb3I6IGJsYWNrOwp9CiNidWlsZC1mb3JtIC5kcm9wZG93bi1tZW51IHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNEREREREQ7Cn0KI2J1aWxkLWZvcm0gLmRyb3Bkb3duLW1lbnU+bGk+YSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREREREREOwogICAgY29sb3I6IHJnYig1MCw1MCw1MCk7CiAgICBmb250LXdlaWdodDogbm9ybWFsOwp9CiNidWlsZC1mb3JtIC5kcm9wZG93bi1tZW51PmxpPmE6aG92ZXJ7CiAgICBjb2xvcjogcmdiKDUwLDUwLDUwKTsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7Cn0KCi5idWlsZC1wcm9qZWN0LWNvbnRhaW5lciB7CgliYWNrZ3JvdW5kOiByZ2IoMjM1LCAyMzYsIDIzNyk7CgltYXJnaW46IDBweDsKfQoKLyogcHJvamVjdHMgdGFibGUgICovCnRkLnByb2plY3RzLWRpc3BsYXktbmFtZSB7CiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlIWltcG9ydGFudDsKICAgIC8qIHRydW5jYXRlIGxvbmcgcmVwbyBkaXNwbGF5IG5hbWVzICovCiAgICBtYXgtd2lkdGg6IDUwY2g7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7Cn0KLnByb2plY3QtdGV4dCB7CglwYWRkaW5nLXRvcDogMzBweDsKCXBhZGRpbmctYm90dG9tOiAzMHB4OwoJbWFyZ2luOiAtMzBweCAtMzJweCAxNXB4IC0zMnB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KLnByb2plY3QtdGV4dCA+IGRpdj4gaW1nIHsKCW1heC13aWR0aDogODAlOwp9CiN5b3VyLXByb2plY3RzIHsKYm9yZGVyOiAxcHggc29saWQgI2NjYzsKYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwwLDAsLjA3NSk7CmJvcmRlci1yYWRpdXM6IDRweDsKfQovKiN5b3VyLXByb2plY3RzID4gdGhlYWQgeyovCi8qISoJYmFja2dyb3VuZC1jb2xvcjogI0RERERERDsgKiEqLwovKn0qLwojeW91ci1wcm9qZWN0cyA+IHRib2R5ID4gdHIgewoJYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKCWJvcmRlcjogMXB4IHNvbGlkICNjY2M7Cn0KLnByb2plY3RzLWNvbnRhaW5lciB7CglwYWRkaW5nLWxlZnQ6IDE4cHg7CglwYWRkaW5nLXJpZ2h0OjE4cHg7CgltYXJnaW4tbGVmdDogLTMzcHg7CgltYXJnaW4tcmlnaHQ6IC0zM3B4Owp9CmRpdi5uby1wcm9qZWN0cyB7CgltYXJnaW4tYm90dG9tOiAxNXB4Owp9Ci5wcm9qZWN0LWxhdW5jaCB7CiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOwp9Ci5kZWxldGUtcHJvamVjdC1sYWJlbCB7CiAgICBmb250LXdlaWdodDogbm9ybWFsOwp9CgoudXJsLCAuYmFkZ2VzIHsKCWRpc3BsYXk6IG5vbmU7Cn0KCmRpdiNsb2ctY29udGFpbmVyIHsKICAgIHdpZHRoOiAxMDAlOwogICAgbWFyZ2luOiAwIDAgMzBweCAwOwp9CgojaG93LWl0LXdvcmtzIHsKICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgICBsaW5lLWhlaWdodDogMS40Owp9CgojaG93LWl0LXdvcmtzID4gZGl2LnJvdyB7CiAgICBtYXJnaW46IDE2cHg7Cn0KCi8qYmluZGVyIGZvcm0qLwovKiNtYWluID4gZGl2LnJvdyA+IGRpdi5jb2wtbGctMTAgeyovCi8qCSEqYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsqISovCi8qCXBhZGRpbmctbGVmdDogMzJweDsqLwovKglwYWRkaW5nLXJpZ2h0OiAzMnB4OyovCi8qICAgIG1hcmdpbi1sZWZ0OiAwOyovCi8qICAgIHdpZHRoOiAxMDAlOyovCi8qfSovCi8qYmluZGVyIGZvb3RlciovCg==
        persistent_bhub_js:
          mountPath: /usr/local/share/jupyterhub/static/persistent_bhub/persistent_bhub.js
          binaryData: cmVxdWlyZShbImpxdWVyeSIsICJqaGFwaSIsICJtb21lbnQiXSwgZnVuY3Rpb24oJCwgSkhBUEksIG1vbWVudCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGJhc2VfdXJsID0gd2luZG93LmpoZGF0YS5iYXNlX3VybDsKICB2YXIgdXNlciA9IHdpbmRvdy5qaGRhdGEudXNlcjsKICB2YXIgYXBpID0gbmV3IEpIQVBJKGJhc2VfdXJsKTsKCiAgLy8gQ3VzdG9taXplIHN0b3Agc2VydmVyIGJ1dHRvbgogICQoIiNzdG9wIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAkKHRoaXMpLnRleHQoJ1N0b3BwaW5nJykKICAgICAgICAgICAuYXR0cigiZGlzYWJsZWQiLCB0cnVlKQogICAgICAgICAgIC5hdHRyKCJ0aXRsZSIsICJZb3VyIHNlcnZlciBpcyBzdG9wcGluZyIpCiAgICAgICAgICAgLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfSk7CiAgICAvLyBoaWRlICJNeSBTZXJ2ZXIiIGJ1dHRvbiB3aGlsZSBzdG9wcGluZwogICAgJCh0aGlzKS5uZXh0KCdhJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgYXBpLnN0b3Bfc2VydmVyKHVzZXIsIHsKICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7CiAgICAgICAgJCgiI3N0b3AiKS5oaWRlKCk7CiAgICAgICAgdmFyIHJlZiA9ICQoJyNzdG9wJykuZGF0YSgncmVmJyk7CiAgICAgICAgJCgnI2xhc3QtdXNlZC0nK3JlZikudGV4dChtb21lbnQoKS5jYWxlbmRhcigpKTsKICAgICAgICAvLyBjaGFuZ2UgdGV4dCBmcm9tICJNeSBTZXJ2ZXIiIHRvICJMYXVuY2giIGFuZCBtYWtlIGFsbCBsYXVuY2ggYnV0dG9ucyB2aXNpYmxlCiAgICAgICAgJCgnLnByb2plY3QtbGF1bmNoJykuYXR0cignaHJlZicsICcjJykudGV4dCgnTGF1bmNoJykucmVtb3ZlQ2xhc3MoJ2J0bi1wcmltYXJ5JykuYWRkQ2xhc3MoJ2J0bi13YXJuaW5nJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICQoJy5wcm9qZWN0LWRlbGV0ZScpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKICAgICAgfQogICAgfSk7CiAgfSk7CgogIC8vIG5pY2UgZm9ybWF0dGluZyBmb3IgIkxhc3QgdXNlZCIgY29sdW1uIGluIHByb2plY3RzIHRhYmxlCiAgLy8gY29waWVkIGZyb20gYWRtaW4uanMKICAkKCIudGltZS1jb2wiKS5tYXAoZnVuY3Rpb24gKGksIGVsKSB7CiAgICAvLyBjb252ZXJ0IElTTyBkYXRlc3RhbXBzIHRvIG5pY2UgbW9tZW50anMgb25lcwogICAgZWwgPSAkKGVsKTsKICAgIGlmIChlbC50ZXh0KCkgIT09ICJydW5uaW5nIiApIHsKICAgICAgICBsZXQgbSA9IG1vbWVudChuZXcgRGF0ZShlbC50ZXh0KCkudHJpbSgpKSk7CiAgICAgICAgLy9lbC50ZXh0KG0uaXNWYWxpZCgpID8gbS5mcm9tTm93KCkgOiAibmV2ZXIiKTsKICAgICAgICBlbC50ZXh0KG0uaXNWYWxpZCgpID8gbS5jYWxlbmRhcigpOiAibmV2ZXIiKTsKICAgIH0KICB9KTsKfSk7CgoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgICAvLyBQcm9qZWN0IGxhdW5jaCB0aHJvdWdoIHRhYmxlCiAgICAkKCcucHJvamVjdC1sYXVuY2gnKS5jbGljayhmdW5jdGlvbihlKSB7CiAgICAgICAgLy8gaWYgc2VydmVyIGlzIHJ1bm5pbmcsIHRoaXMgYnV0dG9uIGhvbGRzIHRoZSB1cmwgb2YgdGhlIHNlcnZlcgogICAgICAgIC8vIGlmIHNlcnZlciBpcyBub3QgcnVubmluZywgZG8gZm9sbG93aW5nCiAgICAgICAgaWYgKCQodGhpcykuYXR0cignaHJlZicpID09PSAnIycpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAvLyQoIiNidWlsZC1mb3JtIikuZ2V0KDApLnNjcm9sbEludG9WaWV3KCk7CiAgICAgICAgICAgIC8vIGZpbGwgdGhlIGJpbmRlciBmb3JtIHdpdGggdmFsdWVzIG9mIHNlbGVjdGVkIHJlcG8gYW5kIHN1Ym1pdAogICAgICAgICAgICB2YXIgcmVmID0gJCh0aGlzKS5wcm9wKCdpZCcpLnJlcGxhY2UoImxhdW5jaC0iLCIiKTsKICAgICAgICAgICAgdmFyIHJlcG9fdXJsID0gJCh0aGlzKS5kYXRhKCd1cmwnKTsKICAgICAgICAgICAgdmFyIHJlcG9fdXJsX2xvd2VyID0gcmVwb191cmwudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgdmFyIHByb3ZpZGVyX3ByZWZpeCA9ICQodGhpcykuZGF0YSgncHJvdmlkZXJfcHJlZml4Jyk7CiAgICAgICAgICAgIHZhciBwcm92aWRlcl9wcmVmaXhfc2VsZWN0ZWQgPSAkKHRoaXMpLmRhdGEoJ3Byb3ZpZGVyX25hbWUnKTsKICAgICAgICAgICAgJCgnI3Byb3ZpZGVyX3ByZWZpeCcpLnZhbChwcm92aWRlcl9wcmVmaXgpOwogICAgICAgICAgICAkKCcjcHJvdmlkZXJfcHJlZml4LXNlbGVjdGVkJykudGV4dChwcm92aWRlcl9wcmVmaXhfc2VsZWN0ZWQpOwogICAgICAgICAgICAkKCcjcmVmJykudmFsKHJlZik7CiAgICAgICAgICAgICQoJyNyZXBvc2l0b3J5JykudmFsKHJlcG9fdXJsKTsKICAgICAgICAgICAgJCgnI2ZpbGVwYXRoJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnYnV0dG9uI3N1Ym1pdCcpLnRyaWdnZXIoJ2NsaWNrJyk7CiAgICAgICAgICAgIC8vIGhpZGUgYWxsIGxhdW5jaCBhbmQgZGVsZXRlIGJ1dHRvbnMKICAgICAgICAgICAgJCgnLnByb2plY3QtbGF1bmNoJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAkKCcucHJvamVjdC1kZWxldGUnKS5hZGRDbGFzcygnaGlkZGVuJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBQcm9qZWN0IGRlbGV0aW9uCiAgICAvLyB3ZSB3b3VsZCB1c2Ugc2hvdy5icy5tb2RhbCBldmVudCBpbnN0ZWFkIG9mIGNsaWNrOiBodHRwczovL2dldGJvb3RzdHJhcC5jb20vZG9jcy8zLjQvamF2YXNjcmlwdC8jbW9kYWxzLWV2ZW50cwogICAgLy8gYnV0IGl0IGJvb3RzdHJhcCBtZXRob2RzIGZhaWxzIGJlY2F1c2Ugd2UgbG9hZCBqcXVlcnkgYWZ0ZXIgYm9vdHN0cmFwIGpzCiAgICAvLyBzZWU6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI1NzU3OTY4L2Jvb3RzdHJhcC1tb2RhbC1pcy1ub3QtYS1mdW5jdGlvbgogICAgJCgnLnByb2plY3QtZGVsZXRlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgLy8gcmVzZXQgcGFydHMgb2YgZGlhbG9nCiAgICAgICAgJCgnI2RlbGV0ZS1wcm9qZWN0LWJvZHknKS5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAkKCcjZGVsZXRlLXByb2plY3QtZXJyb3InKS50ZXh0KCcnKS5hZGRDbGFzcygiaGlkZGVuIik7CiAgICAgICAgJCgnI2RlbGV0ZS1vbi1kaXNrJykucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAkKCcjZGVsZXRlLWNvbmZpcm0nKS50ZXh0KCJEZWxldGUgbm93IikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgLy8gZmlsbCBoaWRkZW4gaW5wdXRzLCB0aGV5IHdpbGwgYmUgdXNlZCBpbiBhamF4IGNhbGwgdG8gZGVsZXRlIHByb2plY3QKICAgICAgICAkKCcjZGVsZXRlLXVybCcpLnZhbCgkKHRoaXMpLmRhdGEoJ3VybCcpKTsKICAgICAgICAkKCcjZGVsZXRlLWlkJykudmFsKCQodGhpcykucHJvcCgnaWQnKSk7ICAvLyB0aGlzIHdpbGwgYmUgdXNlZCBpbiBzdWNjZXNzIHJldHVybiBvZiBhamF4IGNhbGwgdG8gZGVsZXRlIHByb2plY3Qgcm93IGZyb20gdGFibGUKICAgICAgICB2YXIgcHJvamVjdF9uYW1lID0gJCh0aGlzKS5kYXRhKCduYW1lJyk7CiAgICAgICAgJCgnI2RlbGV0ZS1uYW1lJykudmFsKHByb2plY3RfbmFtZSk7CiAgICAgICAgLy8gdXBkYXRlIHRleHQgaW4gY29uZmlybSBkaWFsb2cKICAgICAgICAkKCcjZGVsZXRlLXByb2plY3QtbGFiZWwnKS50ZXh0KCdEZWxldGUgcHJvamVjdDogJyArIHByb2plY3RfbmFtZSk7CiAgICAgICAgJCgnI2RlbGV0ZS1wcm9qZWN0LXRleHQnKS50ZXh0KCdBcmUgeW91IHN1cmUgdGhhdCB5b3Ugd2FudCB0byBkZWxldGUgIicgKyBwcm9qZWN0X25hbWUgKyciIHByb2plY3Q/Jyk7CiAgICB9KTsKICAgICQoJyNkZWxldGUtb24tZGlzaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIC8vIEVuYWJsZS9kaXNhYmxlICJEZWxldGUgbm93IiBidXR0b24gYWNjb3JkaW5nIHRvIGRlbGV0ZS1vbi1kaXNrIGNoZWNrYm94CiAgICAgICAgJCgnI2RlbGV0ZS1jb25maXJtJykucHJvcCgiZGlzYWJsZWQiLCAhJCh0aGlzKS5wcm9wKCJjaGVja2VkIikpOwogICAgfSk7CiAgICBmdW5jdGlvbiBkaXNwbGF5X2Vycm9yKG1lc3NhZ2UpIHsKICAgICAgICAvLyBkaXNwbGF5IGVycm9yIG1lc3NhZ2UgaW4gbW9kYWwKICAgICAgICAkKCcjZGVsZXRlLXByb2plY3QtYm9keScpLmNoaWxkcmVuKCkuYWRkQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICQoJyNkZWxldGUtcHJvamVjdC1lcnJvcicpLnRleHQobWVzc2FnZSkucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICQoJyNkZWxldGUtY29uZmlybScpLmFkZENsYXNzKCJoaWRkZW4iKTsKICAgIH0KICAgICQoJyNkZWxldGUtcHJvamVjdCcpLm9uKCdoaWRlLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAvLyByZXNldCBoaWRkZW4gaW5wdXRzLCB3aGVuIG1vZGFsIGlzIGNsb3NlZAogICAgICAgICQoJyNkZWxldGUtdXJsJykudmFsKCcnKTsKICAgICAgICAkKCcjZGVsZXRlLW5hbWUnKS52YWwoJycpOwogICAgICAgICQoJyNkZWxldGUtaWQnKS52YWwoJycpOwogICAgfSk7CiAgICAkKCcjZGVsZXRlLWNvbmZpcm0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAkKCcjZGVsZXRlLWNvbmZpcm0nKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpLnRleHQoIkRlbGV0aW5nIik7CiAgICAgICAgdmFyIGJvZHkgPSBKU09OLnN0cmluZ2lmeSh7cmVwb191cmw6ICQoJyNkZWxldGUtdXJsJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJCgnI2RlbGV0ZS1uYW1lJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICQoJyNkZWxldGUtaWQnKS52YWwoKX0pOwogICAgICAgIHZhciB1c2VyX25hbWUgPSB3aW5kb3cuamhkYXRhLnVzZXI7CiAgICAgICAgdmFyIHVybCA9ICcvaHViL2FwaS9wcm9qZWN0cy8nK3VzZXJfbmFtZTsKICAgICAgICBjb25zb2xlLmxvZyh1cmwsIGJvZHkpOwogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICB0eXBlOiAnREVMRVRFJywKICAgICAgICAgICAgZGF0YTogYm9keSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZiAoImVycm9yIiBpbiByZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHNob3cgZXJyb3IgbWVzc2FnZSBvbmx5LCB1c2VyIHNob3VsZCBoYW5kbGUgdGhlIGVycm9yIGZpcnN0CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheV9lcnJvcihyZXNwb25zZVsnZXJyb3InXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHByb2plY3QgaXMgZGVsZXRlZAogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBwcm9qZWN0IGZyb20gIllvdXIgUHJvamVjdHMiIHRhYmxlCgogICAgICAgICAgICAgICAgICAgIC8vIGpxdWVyeSBjYW50IHNlbGVjdCBieSBpZCBpZiBpZCBjb250YWlucyBkb3QgaW5zaWRlLCBhbmQgd2UgaGF2ZSB0aGlzIGNhc2UgZm9yIGRlZmF1bHQgcHJvamVjdAogICAgICAgICAgICAgICAgICAgIC8vIHNvIHVzZSBnZXRFbGVtZW50QnlJZAogICAgICAgICAgICAgICAgICAgIC8vJCgiIyIrcmVzcG9uc2VbImlkIl0pLmNsb3Nlc3QoJ3RyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZXNwb25zZVsiaWQiXSkpLmNsb3Nlc3QoJ3RyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQoJyN5b3VyLXByb2plY3RzIHRyJykubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZXIgaGFzIG5vIHByb2plY3RzLCBzbyByZW1vdmUgZW1wdHkgcHJvamVjdHMgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3lvdXItcHJvamVjdHMnKS5hZGRDbGFzcygiaGlkZGVuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNuby1wcm9qZWN0cycpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnByb2plY3RzLWNvbnRhaW5lcicpLmFkZENsYXNzKCJuby1wcm9qZWN0cyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBjbG9zZSBtb2RhbAogICAgICAgICAgICAgICAgICAgIC8vIC5tb2RhbCBmYWlscyBiZWNhdXNlIHdlIGxvYWQganF1ZXJ5IGFmdGVyIGJvb3RzdHJhcCBqcwogICAgICAgICAgICAgICAgICAgIC8vIHNlZTogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjU3NTc5NjgvYm9vdHN0cmFwLW1vZGFsLWlzLW5vdC1hLWZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgLy8kKCcjZGVsZXRlLXByb2plY3QnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICQoJyNkZWxldGUtY2xvc2UnKS50cmlnZ2VyKCdjbGljaycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGRpc3BsYXlfZXJyb3IoIkVycm9yLiBQbGVhc2UgcmVmcmVzaCB0aGUgcGFnZSBhbmQgdHJ5IGFnYWluLiIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKfSk7Cg==
        persistent_bhub_templates_home:
          mountPath: /etc/jupyterhub/templates/home.html
          binaryData: eyUgZXh0ZW5kcyAidGVtcGxhdGVzL2hvbWUuaHRtbCIgJX0KCnslIGJsb2NrIHN0eWxlc2hlZXQgJX0KPG1ldGEgaWQ9ImJhc2UtdXJsIiBkYXRhLXVybD0ie3sgYmluZGVyX2Jhc2VfdXJsIH19Ij4KPG1ldGEgaWQ9ImJhZGdlLWJhc2UtdXJsIiBkYXRhLXVybD0ie3tiYWRnZV9iYXNlX3VybH19Ij4KeyMgc3RhdGljIGZpbGVzIGZyb20gYmluZGVyICN9CjxzY3JpcHQgc3JjPSJ7eyBzdGF0aWNfYmluZGVyIH19ZGlzdC9idW5kbGUuanM/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSI+PC9zY3JpcHQ+CjxsaW5rIGhyZWY9Int7IHN0YXRpY19iaW5kZXIgfX1kaXN0L3N0eWxlcy5jc3M/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSIgcmVsPSJzdHlsZXNoZWV0Ii8+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0ie3sgc3RhdGljX3VybCgiY29tcG9uZW50cy9ib290c3RyYXAvZGlzdC9jc3MvYm9vdHN0cmFwLm1pbi5jc3MiKSB9fSIgdHlwZT0idGV4dC9jc3MiLz4Ke3sgc3VwZXIoKSB9fQo8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Int7IHN0YXRpY191cmwoInBlcnNpc3RlbnRfYmh1Yi9wZXJzaXN0ZW50X2JodWIuY3NzIikgfX0iIHR5cGU9InRleHQvY3NzIi8+CnslIGVuZGJsb2NrIHN0eWxlc2hlZXQgJX0KCnslIGJsb2NrIHNjcmlwdHMgJX0KICAgIDxzY3JpcHQgc3JjPSJ7e3N0YXRpY191cmwoImNvbXBvbmVudHMvcmVxdWlyZWpzL3JlcXVpcmUuanMiKSB9fSIgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBjaGFyc2V0PSJ1dGYtOCI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0ie3tzdGF0aWNfdXJsKCJjb21wb25lbnRzL2pxdWVyeS9kaXN0L2pxdWVyeS5taW4uanMiKSB9fSIgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBjaGFyc2V0PSJ1dGYtOCI+PC9zY3JpcHQ+CnsjICAgIDxzY3JpcHQgc3JjPSJ7e3N0YXRpY191cmwoImNvbXBvbmVudHMvYm9vdHN0cmFwL2Rpc3QvanMvYm9vdHN0cmFwLm1pbi5qcyIpIH19IiB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIGNoYXJzZXQ9InV0Zi04Ij48L3NjcmlwdD4jfQp7JSBlbmRibG9jayBzY3JpcHRzICV9Cgp7JSBibG9jayBtYWluICV9CjxkaXYgaWQ9Im1haW4tY29udGFpbmVyIiBjbGFzcz0iY29udGFpbmVyIj4KICB7JSBibG9jayBiaW5kZXJfaGVhZGVyICV9CiAgICA8ZGl2IGlkPSJoZWFkZXIiIGNsYXNzPSJ0ZXh0LWNlbnRlciI+CiAgICAgICAgeyMgICAgICA8aDM+VHVybiBhIEdpdCByZXBvIGludG8gYSBjb2xsZWN0aW9uIG9mIGludGVyYWN0aXZlIG5vdGVib29rczwvaDM+I30KICAgICAgICA8ZGl2IGlkPSJleHBsYW5hdGlvbiI+CiAgICAgICAgICAgIHslIGJsb2NrIHBlcnNpc3RlbmN5X2V4cGxhbmF0aW9uICV9CiAgICAgICAgICAgIHt7IHBlcnNpc3RlbmN5X2V4cGxhbmF0aW9ufHNhZmUgfX0KICAgICAgICAgICAgeyUgZW5kYmxvY2sgcGVyc2lzdGVuY3lfZXhwbGFuYXRpb24gJX0KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIHslIGVuZGJsb2NrIGJpbmRlcl9oZWFkZXIgJX0KCiAgeyUgYmxvY2sgcHJvamVjdHNfZm9ybSAlfQogICAgICB7JSBzZXQgcmVwb19wcm92aWRlcnMgPSB1c2VyLnNwYXduZXIucmVwb19wcm92aWRlcnMgJX0KICAgICAgPGRpdiBjbGFzcz0icm93IGZvcm0tZ3JvdXAiPjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJyb3cgYnVpbGQtcHJvamVjdC1jb250YWluZXIiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiBidWlsZC1mb3JtLWNvbnRhaW5lciI+CiAgICAgICAgeyUgYmxvY2sgYmluZGVyX2Zvcm0gJX0KICAgICAgICB7IyBjb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vanVweXRlcmh1Yi9iaW5kZXJodWIvYmxvYi8yMDdhZTcwNDc1MmNkZTgyZjMzZmM3NzFhM2I1OGFhMWVjYzA0YjZkL2JpbmRlcmh1Yi90ZW1wbGF0ZXMvaW5kZXguaHRtbCNMMzQgI30KICAgICAgICAgIDxmb3JtIGlkPSJidWlsZC1mb3JtIiBjbGFzcz0iZm9ybSBqdW1ib3Ryb24gYnVpbGQtZm9ybSI+CiAgICAgICAgICAgIDxoMyBpZD0iZm9ybS1oZWFkZXIiIGNsYXNzPSdyb3cnPkJ1aWxkIGFuZCBsYXVuY2ggYSBuZXcgcmVwb3NpdG9yeTwvaDM+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJwcm92aWRlcl9wcmVmaXgiIHZhbHVlPSJnaCIvPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIHJvdyI+CiAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icmVwb3NpdG9yeSI+R2l0SHViIHJlcG9zaXRvcnkgbmFtZSBvciBVUkw8L2xhYmVsPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwLWJ0biIgaWQ9InVybC10eXBlLWJ0biI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkgZHJvcGRvd24tdG9nZ2xlIgogICAgICAgICAgICAgICAgICAgIGRhdGEtdG9nZ2xlPSJkcm9wZG93biIgYXJpYS1oYXNwb3B1cD0idHJ1ZSIgYXJpYS1leHBhbmRlZD0iZmFsc2UiCiAgICAgICAgICAgICAgICAgICAgdGl0bGU9IlNwZWNpZnkgc291cmNlIG9mIHJlcG9zaXRvcnkiCiAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InByb3ZpZGVyX3ByZWZpeC1zZWxlY3RlZCI+CiAgICAgICAgICAgICAgICAgIEdpdEh1YgogICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjYXJldCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51IiBpZD0icHJvdmlkZXJfcHJlZml4X3NlbCI+CiAgICAgICAgICAgICAgICAgICAgeyUgZm9yIHJlcG9fcHJvdmlkZXIgaW4gcmVwb19wcm92aWRlcnMgJX0KICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImRyb3Bkb3duLWl0ZW0iIHZhbHVlPSJ7eyByZXBvX3Byb3ZpZGVyWydwcmVmaXgnXSB9fSI+PGEgaHJlZj0iIyI+e3sgcmVwb19wcm92aWRlclsnbmFtZSddIH19PC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgeyUgZW5kZm9yICV9CiAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIiB0eXBlPSJ0ZXh0IiBpZD0icmVwb3NpdG9yeSIgZGF0YS1scGlnbm9yZT0idHJ1ZSIgcGxhY2Vob2xkZXI9IkdpdEh1YiByZXBvc2l0b3J5IG5hbWUgb3IgVVJMIi8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLXJvdyByb3ciPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLW1kLTQiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icmVmIj5HaXQgYnJhbmNoLCB0YWcsIG9yIGNvbW1pdDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9ImZvcm0tY29udHJvbCIgdHlwZT0idGV4dCIgaWQ9InJlZiIgcGxhY2Vob2xkZXI9IkdpdCBicmFuY2gsIHRhZywgb3IgY29tbWl0Ii8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbWQtNiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJmaWxlcGF0aCI+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIj4KICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNvbnRyb2wiIHR5cGU9InRleHQiIGlkPSJmaWxlcGF0aCIKICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iIgogICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cC1idG4iIGlkPSJ1cmwtb3ItZmlsZS1idG4iPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkgZHJvcGRvd24tdG9nZ2xlIgogICAgICAgICAgICAgICAgICAgICAgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBhcmlhLWhhc3BvcHVwPSJ0cnVlIiBhcmlhLWV4cGFuZGVkPSJmYWxzZSIKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJTcGVjaWZ5IHdoZXRoZXIgdGhlIHBhdGggdG8gb3BlbiBpcyBhIFVSTCBvciBhIGZpbGUiCiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJ1cmwtb3ItZmlsZS1zZWxlY3RlZCI+CiAgICAgICAgICAgICAgICAgICAge3sgJ1VSTCcgaWYgdXJscGF0aCBlbHNlICdGaWxlJyB9fQogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iY2FyZXQiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPgogICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJkcm9wZG93bi1pdGVtIj48YSBocmVmPSIjIj5GaWxlPC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImRyb3Bkb3duLWl0ZW0iPjxhIGhyZWY9IiMiPlVSTDwvYT48L2xpPgogICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLW1kLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYnRuLWdyb3VwIiBpZD0ibGF1bmNoLWJ1dHRvbnMiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzdWJtaXQiIGNsYXNzPSJidG4tc3VibWl0IiB0eXBlPSJzdWJtaXQiPmxhdW5jaDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgeyUgYmxvY2sgcHJvamVjdHNfdGFibGUgJX0KICAgICAgICAgICAgICAgICAgICB7JSBzZXQgcHJvamVjdHMgPSB1c2VyLnNwYXduZXIuZ2V0X3N0YXRlX2ZpZWxkKCdwcm9qZWN0cycpICV9CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvamVjdHMtY29udGFpbmVyeyUgaWYgbm90IHByb2plY3RzICV9IG5vLXByb2plY3RzeyUgZW5kaWYgJX0iPgogICAgICAgICAgICAgICAgICAgICAgPGgzPllvdXIgUHJvamVjdHM8L2gzPgogICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFibGUtcmVzcG9uc2l2ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGlkPSJ5b3VyLXByb2plY3RzIiBjbGFzcz0idGFibGUgdGFibGUtc3RyaXBlZHslIGlmIG5vdCBwcm9qZWN0cyAlfSBoaWRkZW57JSBlbmRpZiAlfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoPlJlcG9zaXRvcnk8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoPkNvbW1pdDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+TGFzdCB1c2VkPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5BY3Rpb25zPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBmb3IgcHJvamVjdCBpbiBwcm9qZWN0cyAlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBzZXQgcHJvamVjdF9ydW5uaW5nID0gbG9vcC5pbmRleCA9PSBsb29wLmxlbmd0aCBhbmQgdXNlci5ydW5uaW5nICV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBzZXQgcHJvamVjdF9hY3RpdmUgPSBsb29wLmluZGV4ID09IGxvb3AubGVuZ3RoIGFuZCB1c2VyLnNwYXduZXIuYWN0aXZlICV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBzZXQgcHJvamVjdF9ub3RfYWN0aXZlID0gdXNlci5zcGF3bmVyLl9zdG9wX3BlbmRpbmcgb3IgKHVzZXIuc3Bhd25lci5hY3RpdmUgYW5kIGxvb3AuaW5kZXggIT0gbG9vcC5sZW5ndGgpICV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InByb2plY3RzLWNlbGwgcHJvamVjdHMtZGlzcGxheS1uYW1lIj48YSBocmVmPSJ7eyBwcm9qZWN0WydyZXBvX3VybCddIH19IiB0YXJnZXQ9Il9ibGFuayI+e3sgcHJvamVjdFsnZGlzcGxheV9uYW1lJ10gfX08L2E+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHJvamVjdHMtY2VsbCI+e3sgcHJvamVjdFsncmVmJ11bOjE2XSB9fTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InByb2plY3RzLWNlbGwgdGltZS1jb2wiIGlkPSJsYXN0LXVzZWQte3sgcHJvamVjdFsncmVmJ10gfX0iPnslIGlmIHByb2plY3RfcnVubmluZyAlfXJ1bm5pbmd7JSBlbHNlICV9e3sgcHJvamVjdFsnbGFzdF91c2VkJ10gfX17JSBlbmRpZiAlfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InByb2plY3RzLWNlbGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHslIGlmIHByb2plY3RfcnVubmluZyAlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsjIGxhc3QgZWxlbWVudCBpbiBwcm9qZWN0cyBpcyBjdXJyZW50bHkgcnVubmluZywgYWRkIFN0b3AgYnV0dG9uIGZvciBpdCAjfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGlkPSJzdG9wIiByb2xlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLXNtIGJ0bi1kYW5nZXIiIGRhdGEtcmVmPSJ7eyBwcm9qZWN0WydyZWYnXSB9fSI+U3RvcDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBlbmRpZiAlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsjIGFkZCBsYXVuY2ggYnV0dG9uIGZvciBlYWNoIGVsZW1lbnQsIGlmIHVzZXIgaGFzIG5vIHNlcnZlciBydW5uaW5nICN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyMgaWYgbGFzdCBlbGVtZW50IGlzIHJ1bm5pbmcsIGhpZGUgbGF1bmNoIGJ1dHRvbnMgb2YgYWxsIG90aGVyIGVsZW1lbnRzICN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgcm9sZT0iYnV0dG9uIiBpZD0ibGF1bmNoLXt7IHByb2plY3RbJ3JlZiddIH19IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJwcm9qZWN0LWxhdW5jaCBidG4gYnRuLXNtIHslIGlmIHByb2plY3RfYWN0aXZlICV9YnRuLXByaW1hcnl7JSBlbHNlICV9YnRuLXdhcm5pbmd7JSBlbmRpZiAlfXslIGlmIHByb2plY3Rfbm90X2FjdGl2ZSAlfSBoaWRkZW57JSBlbmRpZiAlfSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmPSJ7JSBpZiBwcm9qZWN0X2FjdGl2ZSAlfXt7IHVybCB9fXslIGVsc2UgJX0jeyUgZW5kaWYgJX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS11cmw9Int7IHByb2plY3RbJ3JlcG9fdXJsJ10gfX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1wcm92aWRlcl9wcmVmaXg9Int7IHByb2plY3RbJ3Byb3ZpZGVyX3ByZWZpeCddIH19IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtcHJvdmlkZXJfbmFtZT0ie3sgcHJvamVjdFsncHJvdmlkZXJfbmFtZSddIH19Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7JSBpZiBwcm9qZWN0X2FjdGl2ZSAlfU15IFNlcnZlcnslIGVsc2UgJX1MYXVuY2h7JSBlbmRpZiAlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSByb2xlPSJidXR0b24iIGlkPSJkZWxldGUte3sgcHJvamVjdFsncmVmJ10gfX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InByb2plY3QtZGVsZXRlIGJ0biBidG4tc20gYnRuLWRhbmdlcnslIGlmIHVzZXIuc3Bhd25lci5hY3RpdmUgJX0gaGlkZGVueyUgZW5kaWYgJX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZj0iIyIgdGl0bGU9IkRlbGV0ZSBmcm9tIHByb2plY3RzIGxpc3QgYW5kIHBlcnNpc3RlbnQgc3RvcmFnZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXVybD0ie3sgcHJvamVjdFsncmVwb191cmwnXSB9fSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLW5hbWU9Int7IHByb2plY3RbJ2Rpc3BsYXlfbmFtZSddIH19IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdG9nZ2xlPSJtb2RhbCIgZGF0YS10YXJnZXQ9IiNkZWxldGUtcHJvamVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHslIGVuZGZvciAlfQogICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PgogICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ibm8tcHJvamVjdHMiIHslIGlmIHByb2plY3RzICV9Y2xhc3M9ImhpZGRlbiJ7JSBlbmRpZiAlfT5Zb3UgaGF2ZSBubyBwcm9qZWN0cy48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICB7IyBNb2RhbCBmb3IgcHJvamVjdCBkZWxldGlvbiBkaWFsb2cgI30KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbCBmYWRlIiBpZD0iZGVsZXRlLXByb2plY3QiIHRhYmluZGV4PSItMSIgcm9sZT0iZGlhbG9nIiBhcmlhLWxhYmVsbGVkYnk9ImRlbGV0ZS1wcm9qZWN0LWxhYmVsIj4KICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWRpYWxvZyIgcm9sZT0iZG9jdW1lbnQiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1oZWFkZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZGVsZXRlLWNsb3NlIiB0eXBlPSJidXR0b24iIGNsYXNzPSJjbG9zZSIgZGF0YS1kaXNtaXNzPSJtb2RhbCIgYXJpYS1sYWJlbD0iQ2xvc2UiPjxzcGFuIGFyaWEtaGlkZGVuPSJ0cnVlIj4mdGltZXM7PC9zcGFuPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJtb2RhbC10aXRsZSIgaWQ9ImRlbGV0ZS1wcm9qZWN0LWxhYmVsIj5EZWxldGUgYSBwcm9qZWN0PC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1ib2R5IiBpZD0iZGVsZXRlLXByb2plY3QtYm9keSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZGVsZXRlLXByb2plY3QtdGV4dCI+QXJlIHlvdSBzdXJlIHRoYXQgeW91IHdhbnQgdG8gZGVsZXRlIHRoZSBwcm9qZWN0Pzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZGVsZXRlLXByb2plY3QtbGFiZWwiPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImRlbGV0ZS1vbi1kaXNrIj4gSSBkbyB1bmRlcnN0YW5kIHRoYXQgdGhpcyBhbHNvIGRlbGV0ZXMgdGhlIGZpbGVzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHByb2plY3QuPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJkZWxldGUtdXJsIiB2YWx1ZT0iIi8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0iZGVsZXRlLWlkIiB2YWx1ZT0iIi8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0iZGVsZXRlLW5hbWUiIHZhbHVlPSIiLz4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJkZWxldGUtcHJvamVjdC1lcnJvciIgY2xhc3M9ImFsZXJ0IGFsZXJ0LWRhbmdlciBoaWRkZW4iPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWZvb3RlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgaWQ9ImRlbGV0ZS1jb25maXJtIiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IGJ0bi1kYW5nZXIiIGRpc2FibGVkPkRlbGV0ZSBub3c8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIHslIGVuZGJsb2NrIHByb2plY3RzX3RhYmxlICV9CgoKICAgICAgICAgICAgPCEtLXVybCBzZWN0aW9uLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InVybCByb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZHJvcGRvd25tZW51Ij4KICAgICAgICAgICAgICAgICAgPGxhYmVsPkNvcHkgdGhlIFVSTCBiZWxvdyBhbmQgc2hhcmUgeW91ciBCaW5kZXIgd2l0aCBvdGhlcnM6PC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idXJsLXJvdyI+CiAgICAgICAgICAgICAgICAgIDxwcmUgaWQ9ImJhc2ljLXVybC1zbmlwcGV0IiBkYXRhLWRlZmF1bHQ9IkZpbGwgaW4gdGhlIGZpZWxkcyB0byBzZWUgYSBVUkwgZm9yIHNoYXJpbmcgeW91ciBCaW5kZXIuIj48L3ByZT4KICAgICAgICAgICAgICAgICAgPGltZyBjbGFzcz0iaWNvbiBjbGlwYm9hcmQiIHNyYz0ie3sgc3RhdGljX2JpbmRlciB9fWltYWdlcy9jb3B5LWljb24tYmxhY2suc3ZnP3Y9e3sgc3RhdGljX3ZlcnNpb24gfX0iIGRhdGEtY2xpcGJvYXJkLXRhcmdldD0iI2Jhc2ljLXVybC1zbmlwcGV0IiBhbHQ9IkNvcHkgdG8gY2xpcGJvYXJkIj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhZGdlcyByb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZHJvcGRvd25tZW51IiBpZD0idG9nZ2xlLWJhZGdlLXNuaXBwZXQiPgogICAgICAgICAgICAgICAgICA8bGFiZWw+Q29weSB0aGUgdGV4dCBiZWxvdywgdGhlbiBwYXN0ZSBpbnRvIHlvdXIgUkVBRE1FIHRvIHNob3cgYSBiaW5kZXIgYmFkZ2U6IDxpbWcgaWQ9ImJhZGdlIiBzcmM9Int7IHN0YXRpY19iaW5kZXIgfX1pbWFnZXMvYmFkZ2VfbG9nby5zdmc/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSI+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgPGEgaWQ9ImJhZGdlLWxpbmsiPjwvYT4KICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iIyIgdGl0bGU9InNob3cgYmFkZ2Ugc25pcHBldHMiPjxzcGFuIGlkPSJiYWRnZS1zbmlwcGV0LWNhcmV0IiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi10cmlhbmdsZS1yaWdodCI+PC9zcGFuPjwvYT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0iYmFkZ2Utc25pcHBldHMiIGNsYXNzPSJoaWRkZW4iPgogICAgICAgICAgICAgICAgICA8IS0tTWFya2Rvd24gc2VjdGlvbi0tPgogICAgICAgICAgICAgICAgICA8ZGl2ICBjbGFzcz0iYmFkZ2Utc25pcHBldC1yb3ciPgogICAgICAgICAgICAgICAgICAgICA8cHJlIGlkPSJtYXJrZG93bi1iYWRnZS1zbmlwcGV0IiBkYXRhLWRlZmF1bHQ9IkZpbGwgaW4gdGhlIGZpZWxkcyB0byBzZWUgdGhlIG1hcmtkb3duIGJhZGdlIHNuaXBwZXQuIj48L3ByZT4KICAgICAgICAgICAgICAgICAgICAgPGltZyBjbGFzcz0iaWNvbiIgc3JjPSJ7eyBzdGF0aWNfYmluZGVyIH19aW1hZ2VzL21hcmtkb3duLWljb24uc3ZnP3Y9e3sgc3RhdGljX3ZlcnNpb24gfX0iPgogICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJpY29uIGNsaXBib2FyZCIKICAgICAgICAgICAgICAgICAgICAgICAgc3JjPSJ7eyBzdGF0aWNfYmluZGVyIH19aW1hZ2VzL2NvcHktaWNvbi1ibGFjay5zdmc/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSIKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1jbGlwYm9hcmQtdGFyZ2V0PSIjbWFya2Rvd24tYmFkZ2Utc25pcHBldCIKICAgICAgICAgICAgICAgICAgICAgICAgYWx0PSJDb3B5IG1hcmtkb3duIGxpbmsgdG8gY2xpcGJvYXJkIj4KICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgIDwhLS1SU1Qgc2VjdGlvbi0tPgogICAgICAgICAgICAgICAgICA8ZGl2ICBjbGFzcz0iYmFkZ2Utc25pcHBldC1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgPHByZSBpZD0icnN0LWJhZGdlLXNuaXBwZXQiIGRhdGEtZGVmYXVsdD0iRmlsbCBpbiB0aGUgZmllbGRzIHRvIHNlZSB0aGUgclNUIGJhZGdlIHNuaXBwZXQuIj48L3ByZT4KICAgICAgICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9Imljb24iIHNyYz0ie3sgc3RhdGljX2JpbmRlciB9fWltYWdlcy9yc3QtaWNvbi5zdmc/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSI+CiAgICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJpY29uIGNsaXBib2FyZCIgc3JjPSJ7eyBzdGF0aWNfYmluZGVyIH19aW1hZ2VzL2NvcHktaWNvbi1ibGFjay5zdmc/dj17eyBzdGF0aWNfdmVyc2lvbiB9fSIKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1jbGlwYm9hcmQtdGFyZ2V0PSIjcnN0LWJhZGdlLXNuaXBwZXQiCiAgICAgICAgICAgICAgICAgICAgICAgIGFsdD0iQ29weSByc3QgbGluayB0byBjbGlwYm9hcmQiPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgaWQ9ImJ1aWxkLXByb2dyZXNzIiBjbGFzcz0icHJvZ3Jlc3Mgb24tYnVpbGQgaGlkZGVuIHJvdyI+CiAgICAgICAgICAgICAgPGRpdiBpZD0icGhhc2UtZmFpbGVkIiBjbGFzcz0icHJvZ3Jlc3MtYmFyIHByb2dyZXNzLWJhci1kYW5nZXIgcHJvZ3Jlc3MtYmFyLXN0cmlwZWQgaGlkZGVuIiBzdHlsZT0id2lkdGg6IDEwMCUiPgogICAgICAgICAgICAgICAgRmFpbGVkLiBUcnkgcmVmcmVzaGluZyB0aGlzIHBhZ2UgaW4gYSBmZXcgc2Vjb25kcy4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGlkPSJwaGFzZS13YWl0aW5nIiBjbGFzcz0icHJvZ3Jlc3MtYmFyIHByb2dyZXNzLWJhci1kYW5nZXIgcHJvZ3Jlc3MtYmFyLXN0cmlwZWQgYWN0aXZlIGhpZGRlbiIgc3R5bGU9IndpZHRoOiAxMCUiPgogICAgICAgICAgICAgICAgV2FpdGluZwogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgaWQ9InBoYXNlLWFscmVhZHktYnVpbHQiIGNsYXNzPSJwcm9ncmVzcy1iYXIgcHJvZ3Jlc3MtYmFyLXdhcm5pbmcgcHJvZ3Jlc3MtYmFyLXN0cmlwZWQgYWN0aXZlIGhpZGRlbiIgc3R5bGU9IndpZHRoOiA5MCUiPgogICAgICAgICAgICAgICAgQWxyZWFkeSBidWlsdCEKICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGlkPSJwaGFzZS1idWlsZGluZyIgY2xhc3M9InByb2dyZXNzLWJhciBwcm9ncmVzcy1iYXItd2FybmluZyBwcm9ncmVzcy1iYXItc3RyaXBlZCBhY3RpdmUgaGlkZGVuIiBzdHlsZT0id2lkdGg6IDQwJSI+CiAgICAgICAgICAgICAgICBCdWlsZGluZwogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgaWQ9InBoYXNlLXB1c2hpbmciIGNsYXNzPSJwcm9ncmVzcy1iYXIgcHJvZ3Jlc3MtYmFyLWluZm8gcHJvZ3Jlc3MtYmFyLXN0cmlwZWQgYWN0aXZlIGhpZGRlbiIgc3R5bGU9IndpZHRoOiA0MCUiPgogICAgICAgICAgICAgICAgUHVzaGluZwogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgaWQ9InBoYXNlLWxhdW5jaGluZyIgY2xhc3M9InByb2dyZXNzLWJhciBwcm9ncmVzcy1iYXItc3VjY2VzcyBwcm9ncmVzcy1iYXItc3RyaXBlZCBhY3RpdmUgaGlkZGVuIiBzdHlsZT0id2lkdGg6IDEwJSI+CiAgICAgICAgICAgICAgICBMYXVuY2hpbmcKICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGlkPSJsb2ctY29udGFpbmVyIiBjbGFzcz0icGFuZWwgcGFuZWwtZGVmYXVsdCBvbi1idWlsZCBoaWRkZW4gcm93Ij4KICAgICAgICAgICAgICA8ZGl2IGlkPSJ0b2dnbGUtbG9ncyIgY2xhc3M9InBhbmVsLWhlYWRpbmciPgogICAgICAgICAgICAgICAgQnVpbGQgbG9ncwogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIHB1bGwtcmlnaHQiPnNob3c8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYW5lbC1ib2R5IGhpZGRlbiI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsb2ciPjwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZm9ybT4KICAgICAgICB7JSBlbmRibG9jayBiaW5kZXJfZm9ybSAlfQogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InJvdyBmb3JtLWdyb3VwIj48L2Rpdj4KICB7JSBlbmRibG9jayBwcm9qZWN0c19mb3JtICV9CgogIHslIGJsb2NrIGhvd19pdF93b3JrcyAlfQogIDxkaXYgaWQ9Imhvdy1pdC13b3JrcyI+CiAgICA8aDMgY2xhc3M9InRleHQtY2VudGVyIj5Ib3cgaXQgd29ya3M8L2gzPgoKICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC0xIGNvbC1tZC1vZmZzZXQtMiBwb2ludC1jb250YWluZXIiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwb2ludCBwb2ludC1vcmFuZ2UiPjE8L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNyBmcm9udCI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImZyb250LWVtIj5CdWlsZCByZXBvc2l0b3JpZXMgbGlrZSA8YSBocmVmPSJodHRwOi8vbXliaW5kZXIub3JnLyI+TXlCaW5kZXIub3JnPC9hPjwvc3Bhbj48YnI+RW50ZXIgeW91ciByZXBvc2l0b3J5IGluZm9ybWF0aW9uIGluIHRoZSA8YSBocmVmPSJodHRwczovL215YmluZGVyLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9pbnRyb2R1Y3Rpb24uaHRtbCI+QmluZGVyPC9hPiBmb3JtLgogICAgICAgIFdlIGJ1aWxkIGFuZCBsYXVuY2ggeW91ciA8YSBocmVmPSJodHRwczovL25vdGVib29rcy5nZXNpcy5vcmcvZ2FsbGVyeS8iPmJpbmRlci1yZWFkeTwvYT4gcmVwb3NpdG9yeSBzbyB0aGF0IHlvdSBjYW4gaW50ZXJhY3Qgd2l0aCBpdCBqdXN0IGxpa2Ugb24gPGEgaHJlZj0iaHR0cHM6Ly9iaW5kZXJodWIucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2tub3duLWRlcGxveW1lbnRzLmh0bWwiPmFueSBvdGhlcjwvYT4gQmluZGVyIGRlcGxveW1lbnQuCiAgICAgICAgT25jZSBhIHJlcG9zaXRvcnkgaGFzIGJlZW4gbGF1bmNoZWQgaXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgbGlzdCBvZiB5b3VyIHByb2plY3RzLgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC0xIGNvbC1tZC1vZmZzZXQtMiBwb2ludC1jb250YWluZXIiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwb2ludCBwb2ludC1yZWQiPjI8L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNyBmcm9udCI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImZyb250LWVtIj5QZXJzaXN0IC9wcm9qZWN0cyBsaWtlIGEgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2p1cHl0ZXIvZG9ja2VyLXN0YWNrcy9pc3N1ZXMvMzU4I2lzc3VlY29tbWVudC0yODg4NDQ4MzQiPkpvdnlhbjwvYT4gPC9zcGFuPjxicj5Zb3UgYXJlIG5vdCBqdXN0IGEgdmlzaXRvciwgYnV0IGEgdHJ1ZSByZXNpZGVudCBvbiA8YSBocmVmPSIiPkp1cHl0ZXI8L2E+LgogICAgICAgIFlvdXIgcHJvamVjdHMgaGF2ZSBhIHBlcnNpc3RlbnQgJEhPTUUgZGlyZWN0b3J5IHdob3NlIGNvbnRlbnRzIGFyZSBtaXJyb3JlZCBhdCAvcHJvamVjdHMuIFVzZSB0aGUgYnV0dG9ucyBpbiB0aGUgdGFibGUgdG8gbGF1bmNoLCBzdG9wIG9yIGRlbGV0ZSBhbiBleGlzdGluZyBwcm9qZWN0LgogICAgICAgIFRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vZ2VzaXNjc3MvZGF0YV9zY2llbmNlX2ltYWdlIj5kYXRhIHNjaWVuY2U8L2E+ICBpbWFnZSBjYW4gYmUgeW91ciBwbGFjZSB0byBiZWdpbi4gVG8gdXBkYXRlIGEgcHJvamVjdC1pbWFnZSB1c2UgdGhlIEJpbmRlciBmb3JtIGFuZCBmb3IgZmlsZXMgdXNlIGdpdC4KICAgICAgICBZb3UgY2FuIGxhdW5jaCBvbmUgcHJvamVjdCBhdCBhIHRpbWUgYW5kIGhhdmUgdXAgdG8gNSBwcm9qZWN0cyBpbiB0b3RhbC4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgeyUgZW5kYmxvY2sgaG93X2l0X3dvcmtzICV9CgogIHslIGJsb2NrIGV4dHJhX21haW5fY29udGVudCAlfQogICAgICB7eyBleHRyYV9tYWluX2NvbnRlbnR8c2FmZSB9fQogIHslIGVuZGJsb2NrIGV4dHJhX21haW5fY29udGVudCAlfQo8L2Rpdj4KeyUgZW5kYmxvY2sgbWFpbiAlfQoKeyUgYmxvY2sgc2NyaXB0ICV9CjxzY3JpcHQgc3JjPSJ7e3N0YXRpY191cmwoInBlcnNpc3RlbnRfYmh1Yi9wZXJzaXN0ZW50X2JodWIuanMiKSB9fSIgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBjaGFyc2V0PSJ1dGYtOCI+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KLy8gaW5pdGlhbGl6ZSBiaW5kZXIgZm9ybQppbmRleE1haW4oKTsKPC9zY3JpcHQ+CnslIGVuZGJsb2NrICV9Cg==


      templateVars:
        persistency_explanation:
          name: "Have a Binder-Ready repository? With Persistent BinderHub, turn this repository into a persistent Jupyter environment, allowing you to continue your analysis from anywhere at any time."
      #shutdownOnLogout: true
      #authenticatePrometheus: false
      redirectToServer: false
      services:
        binder:
          oauth_no_confirm: true
          oauth_client_id: "binder-oauth-client-test"
      config:
        JupyterHub:
          authenticator_class: dummy
      extraConfig:
        20-template-variables:  |
          import random

          c.JupyterHub.template_vars.update({
              "binder_base_url": "/services/binder/",
              "static_binder": "/services/binder/static/",
              "static_version": hex(random.getrandbits(128))[2:],
          })
        10-project-api: |
          from persistent_bhub_config import ProjectAPIHandler

          c.JupyterHub.extra_handlers = [(r'/api/projects/([^/]+)', ProjectAPIHandler)]
          # restart_policy is already set 'OnFailure' by kubespawner:
          # https://github.com/jupyterhub/kubespawner/blob/8751773916ccc6b84c998f7950dd3e07fea5ae4e/kubespawner/objects.py#L231
          # c.KubeSpawner.extra_pod_config.update({'restart_policy': 'OnFailure'})
        00-binder: |
          import pathlib
          a= pathlib.Path(__file__).parent.resolve()
          print(a)
          p = a.glob('**/*')
          files = [x for x in p if x.is_file()]
          print(files)
          from persistent_bhub_config import PersistentBinderSpawner
          c.JupyterHub.spawner_class = PersistentBinderSpawner

    proxy:
      chp:
        # NOTE: hub and proxy must have 1 pod
        # (https://github.com/jupyterhub/jupyterhub/issues/2841#issuecomment-561848594)
        # replicas: 1
        pdb:
          minAvailable: 0

    singleuser:
      # events_enabled - to get events from kubespawner
      events: true
      # to make notebook servers aware of hub
      cmd: jupyterhub-singleuser
      storage:
        type: dynamic
        capacity: 10Gi
      # this is not used, default_project is used instead
      image:
        name: null
        tag: null

    # https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/optimization.html#pulling-images-before-users-arrive
    # we dont need this, because default project must be always built at first
    prePuller:
      hook:
        enabled: false
      continuous:
        enabled: false
